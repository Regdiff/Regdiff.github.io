<!DOCTYPE html><html><head><meta name="author" content="Circle 阅读助手" /><meta name="description" content="由 [Circle 阅读助手](https://circlereader.com) 生成" /><link rel="shortcut icon" type="image/x-icon" href="https://static.zhihu.com/heifetz/favicon.ico"  /><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><style>html,body{padding:0;margin:0;}.card{min-height:100vh;}.container .ant-app{padding-right: 0 !important;}
.anticon {
  display: inline-flex;
  alignItems: center;
  color: inherit;
  font-style: normal;
  line-height: 0;
  text-align: center;
  text-transform: none;
  vertical-align: -0.125em;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.anticon > * {
  line-height: 1;
}

.anticon svg {
  display: inline-block;
}

.anticon::before {
  display: none;
}

.anticon .anticon-icon {
  display: block;
}

.anticon[tabindex] {
  cursor: pointer;
}

.anticon-spin::before,
.anticon-spin {
  display: inline-block;
  -webkit-animation: loadingCircle 1s infinite linear;
  animation: loadingCircle 1s infinite linear;
}

@-webkit-keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}

@keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
.css-16cpc8y a{color:#416ed2;text-decoration:none;background-color:transparent;outline:none;cursor:pointer;transition:color 0.3s;-webkit-text-decoration-skip:objects;}.css-16cpc8y a:hover{color:#305ab7;}.css-16cpc8y a:active{color:#305ab7;}.css-16cpc8y a:active,.css-16cpc8y a:hover{text-decoration:none;outline:0;}.css-16cpc8y a:focus{text-decoration:none;outline:0;}.css-16cpc8y a[disabled]{color:rgba(0, 0, 0, 0.25);cursor:not-allowed;}.css-16cpc8y[class^="ant-avatar"],.css-16cpc8y[class*=" ant-avatar"]{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';font-size:14px;box-sizing:border-box;}.css-16cpc8y[class^="ant-avatar"]::before,.css-16cpc8y[class*=" ant-avatar"]::before,.css-16cpc8y[class^="ant-avatar"]::after,.css-16cpc8y[class*=" ant-avatar"]::after{box-sizing:border-box;}.css-16cpc8y[class^="ant-avatar"] [class^="ant-avatar"],.css-16cpc8y[class*=" ant-avatar"] [class^="ant-avatar"],.css-16cpc8y[class^="ant-avatar"] [class*=" ant-avatar"],.css-16cpc8y[class*=" ant-avatar"] [class*=" ant-avatar"]{box-sizing:border-box;}.css-16cpc8y[class^="ant-avatar"] [class^="ant-avatar"]::before,.css-16cpc8y[class*=" ant-avatar"] [class^="ant-avatar"]::before,.css-16cpc8y[class^="ant-avatar"] [class*=" ant-avatar"]::before,.css-16cpc8y[class*=" ant-avatar"] [class*=" ant-avatar"]::before,.css-16cpc8y[class^="ant-avatar"] [class^="ant-avatar"]::after,.css-16cpc8y[class*=" ant-avatar"] [class^="ant-avatar"]::after,.css-16cpc8y[class^="ant-avatar"] [class*=" ant-avatar"]::after,.css-16cpc8y[class*=" ant-avatar"] [class*=" ant-avatar"]::after{box-sizing:border-box;}.css-16cpc8y.ant-avatar{box-sizing:border-box;margin:0;padding:0;color:#fff;font-size:14px;line-height:1.5714285714285714;list-style:none;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';position:relative;display:inline-flex;justify-content:center;align-items:center;overflow:hidden;white-space:nowrap;text-align:center;vertical-align:middle;background:rgb(127,127,127);border:1px solid transparent;width:32px;height:32px;border-radius:50%;}.css-16cpc8y.ant-avatar-image{background:transparent;}.css-16cpc8y.ant-avatar .ant-image-img{display:block;}.css-16cpc8y.ant-avatar.ant-avatar-square{border-radius:6px;}.css-16cpc8y.ant-avatar.ant-avatar-icon{font-size:18px;}.css-16cpc8y.ant-avatar.ant-avatar-icon >.anticon{margin:0;}.css-16cpc8y.ant-avatar-lg{width:40px;height:40px;border-radius:50%;}.css-16cpc8y.ant-avatar-lg.ant-avatar-square{border-radius:8px;}.css-16cpc8y.ant-avatar-lg.ant-avatar-icon{font-size:24px;}.css-16cpc8y.ant-avatar-lg.ant-avatar-icon >.anticon{margin:0;}.css-16cpc8y.ant-avatar-sm{width:24px;height:24px;border-radius:50%;}.css-16cpc8y.ant-avatar-sm.ant-avatar-square{border-radius:4px;}.css-16cpc8y.ant-avatar-sm.ant-avatar-icon{font-size:14px;}.css-16cpc8y.ant-avatar-sm.ant-avatar-icon >.anticon{margin:0;}.css-16cpc8y.ant-avatar >img{display:block;width:100%;height:100%;object-fit:cover;}.css-16cpc8y.ant-avatar-group{display:inline-flex;}.css-16cpc8y.ant-avatar-group .ant-avatar{border-color:#ffffff;}.css-16cpc8y.ant-avatar-group >*:not(:first-child){margin-left:-8px;}.css-16cpc8y.ant-avatar-group-popover .ant-avatar+.ant-avatar{margin-left:4px;}.css-16cpc8y.ant-btn{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';font-size:14px;box-sizing:border-box;}.css-16cpc8y.ant-btn::before,.css-16cpc8y.ant-btn::after{box-sizing:border-box;}.css-16cpc8y.ant-btn [class^="ant-btn"],.css-16cpc8y.ant-btn [class*=" ant-btn"]{box-sizing:border-box;}.css-16cpc8y.ant-btn [class^="ant-btn"]::before,.css-16cpc8y.ant-btn [class*=" ant-btn"]::before,.css-16cpc8y.ant-btn [class^="ant-btn"]::after,.css-16cpc8y.ant-btn [class*=" ant-btn"]::after{box-sizing:border-box;}.css-16cpc8y.ant-btn{outline:none;position:relative;display:inline-block;font-weight:400;white-space:nowrap;text-align:center;background-image:none;background:transparent;border:1px solid transparent;cursor:pointer;transition:all 0.2s cubic-bezier(0.645, 0.045, 0.355, 1);user-select:none;touch-action:manipulation;color:#1b1b1b;}.css-16cpc8y.ant-btn:disabled>*{pointer-events:none;}.css-16cpc8y.ant-btn >span{display:inline-block;}.css-16cpc8y.ant-btn .ant-btn-icon{line-height:0;}.css-16cpc8y.ant-btn >.anticon+span,.css-16cpc8y.ant-btn >span+.anticon{margin-left:8px;}.css-16cpc8y.ant-btn:not(.ant-btn-icon-only)>.ant-btn-icon.ant-btn-loading-icon,.css-16cpc8y.ant-btn:not(.ant-btn-icon-only)>.ant-btn-icon:not(:last-child){margin-right:8px;}.css-16cpc8y.ant-btn >a{color:currentColor;}.css-16cpc8y.ant-btn:not(:disabled):focus-visible{outline:4px solid #c3d9f7;outline-offset:1px;transition:outline-offset 0s,outline 0s;}.css-16cpc8y.ant-btn.ant-btn-two-chinese-chars::first-letter{letter-spacing:0.34em;}.css-16cpc8y.ant-btn.ant-btn-two-chinese-chars>*:not(.anticon){margin-right:-0.34em;letter-spacing:0.34em;}.css-16cpc8y.ant-btn-icon-only.ant-btn-compact-item{flex:none;}.css-16cpc8y.ant-btn{font-size:14px;line-height:1.5714285714285714;height:32px;padding:4px 15px;border-radius:6px;}.css-16cpc8y.ant-btn.ant-btn-icon-only{width:32px;padding-left:0;padding-right:0;}.css-16cpc8y.ant-btn.ant-btn-icon-only.ant-btn-round{width:auto;}.css-16cpc8y.ant-btn.ant-btn-icon-only .anticon{font-size:16px;}.css-16cpc8y.ant-btn.ant-btn-loading{opacity:0.65;cursor:default;}.css-16cpc8y.ant-btn .ant-btn-loading-icon{transition:width 0.3s cubic-bezier(0.645, 0.045, 0.355, 1),opacity 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);}.css-16cpc8y.ant-btn.ant-btn-circle.ant-btn{min-width:32px;padding-left:0;padding-right:0;border-radius:50%;}.css-16cpc8y.ant-btn.ant-btn-round.ant-btn{border-radius:32px;padding-left:16px;padding-right:16px;}.css-16cpc8y.ant-btn-sm{font-size:14px;line-height:1.5714285714285714;height:24px;padding:0px 7px;border-radius:4px;}.css-16cpc8y.ant-btn-sm.ant-btn-icon-only{width:24px;padding-left:0;padding-right:0;}.css-16cpc8y.ant-btn-sm.ant-btn-icon-only.ant-btn-round{width:auto;}.css-16cpc8y.ant-btn-sm.ant-btn-icon-only .anticon{font-size:14px;}.css-16cpc8y.ant-btn-sm.ant-btn-loading{opacity:0.65;cursor:default;}.css-16cpc8y.ant-btn-sm .ant-btn-loading-icon{transition:width 0.3s cubic-bezier(0.645, 0.045, 0.355, 1),opacity 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);}.css-16cpc8y.ant-btn.ant-btn-circle.ant-btn-sm{min-width:24px;padding-left:0;padding-right:0;border-radius:50%;}.css-16cpc8y.ant-btn.ant-btn-round.ant-btn-sm{border-radius:24px;padding-left:12px;padding-right:12px;}.css-16cpc8y.ant-btn-lg{font-size:16px;line-height:1.5;height:40px;padding:7px 15px;border-radius:8px;}.css-16cpc8y.ant-btn-lg.ant-btn-icon-only{width:40px;padding-left:0;padding-right:0;}.css-16cpc8y.ant-btn-lg.ant-btn-icon-only.ant-btn-round{width:auto;}.css-16cpc8y.ant-btn-lg.ant-btn-icon-only .anticon{font-size:18px;}.css-16cpc8y.ant-btn-lg.ant-btn-loading{opacity:0.65;cursor:default;}.css-16cpc8y.ant-btn-lg .ant-btn-loading-icon{transition:width 0.3s cubic-bezier(0.645, 0.045, 0.355, 1),opacity 0.3s cubic-bezier(0.645, 0.045, 0.355, 1);}.css-16cpc8y.ant-btn.ant-btn-circle.ant-btn-lg{min-width:40px;padding-left:0;padding-right:0;border-radius:50%;}.css-16cpc8y.ant-btn.ant-btn-round.ant-btn-lg{border-radius:40px;padding-left:20px;padding-right:20px;}.css-16cpc8y.ant-btn.ant-btn-block{width:100%;}.css-16cpc8y.ant-btn-default{background:#ffffff;border-color:rgba(237,237,237, 0.6);color:#1b1b1b;box-shadow:0 2px 0 rgba(0, 0, 0, 0.02);}.css-16cpc8y.ant-btn-default:disabled,.css-16cpc8y.ant-btn-default.ant-btn-disabled{cursor:not-allowed;border-color:rgba(237,237,237, 0.6);color:rgba(0, 0, 0, 0.25);background:rgba(0, 0, 0, 0.04);box-shadow:none;}.css-16cpc8y.ant-btn-default:not(:disabled):not(.ant-btn-disabled):hover{color:#6891de;border-color:#6891de;background:#ffffff;}.css-16cpc8y.ant-btn-default:not(:disabled):not(.ant-btn-disabled):active{color:#2c50ab;border-color:#2c50ab;background:#ffffff;}.css-16cpc8y.ant-btn-default.ant-btn-background-ghost{color:#ffffff;background:transparent;border-color:#ffffff;box-shadow:none;}.css-16cpc8y.ant-btn-default.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):hover{background:transparent;}.css-16cpc8y.ant-btn-default.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):active{background:transparent;}.css-16cpc8y.ant-btn-default.ant-btn-background-ghost:disabled{cursor:not-allowed;color:rgba(0, 0, 0, 0.25);border-color:rgba(237,237,237, 0.6);}.css-16cpc8y.ant-btn-default.ant-btn-dangerous{color:#ff4d4f;border-color:#ff4d4f;}.css-16cpc8y.ant-btn-default.ant-btn-dangerous:not(:disabled):not(.ant-btn-disabled):hover{color:#ff7875;border-color:#ffa39e;}.css-16cpc8y.ant-btn-default.ant-btn-dangerous:not(:disabled):not(.ant-btn-disabled):active{color:#d9363e;border-color:#d9363e;}.css-16cpc8y.ant-btn-default.ant-btn-dangerous.ant-btn-background-ghost{color:#ff4d4f;background:transparent;border-color:#ff4d4f;box-shadow:none;}.css-16cpc8y.ant-btn-default.ant-btn-dangerous.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):hover{background:transparent;}.css-16cpc8y.ant-btn-default.ant-btn-dangerous.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):active{background:transparent;}.css-16cpc8y.ant-btn-default.ant-btn-dangerous.ant-btn-background-ghost:disabled{cursor:not-allowed;color:rgba(0, 0, 0, 0.25);border-color:rgba(237,237,237, 0.6);}.css-16cpc8y.ant-btn-default.ant-btn-dangerous:disabled,.css-16cpc8y.ant-btn-default.ant-btn-dangerous.ant-btn-disabled{cursor:not-allowed;border-color:rgba(237,237,237, 0.6);color:rgba(0, 0, 0, 0.25);background:rgba(0, 0, 0, 0.04);box-shadow:none;}.css-16cpc8y.ant-btn-primary{color:#fff;background:#416ed2;box-shadow:0 2px 0 rgba(5, 122, 255, 0.06);}.css-16cpc8y.ant-btn-primary:disabled,.css-16cpc8y.ant-btn-primary.ant-btn-disabled{cursor:not-allowed;border-color:rgba(237,237,237, 0.6);color:rgba(0, 0, 0, 0.25);background:rgba(0, 0, 0, 0.04);box-shadow:none;}.css-16cpc8y.ant-btn-primary:not(:disabled):not(.ant-btn-disabled):hover{color:#fff;background:#6891de;}.css-16cpc8y.ant-btn-primary:not(:disabled):not(.ant-btn-disabled):active{color:#fff;background:#2c50ab;}.css-16cpc8y.ant-btn-primary.ant-btn-background-ghost{color:#416ed2;background:transparent;border-color:#416ed2;box-shadow:none;}.css-16cpc8y.ant-btn-primary.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):hover{background:transparent;color:#6891de;border-color:#6891de;}.css-16cpc8y.ant-btn-primary.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):active{background:transparent;color:#2c50ab;border-color:#2c50ab;}.css-16cpc8y.ant-btn-primary.ant-btn-background-ghost:disabled{cursor:not-allowed;color:rgba(0, 0, 0, 0.25);border-color:rgba(237,237,237, 0.6);}.css-16cpc8y.ant-btn-primary.ant-btn-dangerous{background:#ff4d4f;box-shadow:0 2px 0 rgba(255, 38, 5, 0.06);color:#fff;}.css-16cpc8y.ant-btn-primary.ant-btn-dangerous:not(:disabled):not(.ant-btn-disabled):hover{background:#ff7875;}.css-16cpc8y.ant-btn-primary.ant-btn-dangerous:not(:disabled):not(.ant-btn-disabled):active{background:#d9363e;}.css-16cpc8y.ant-btn-primary.ant-btn-dangerous.ant-btn-background-ghost{color:#ff4d4f;background:transparent;border-color:#ff4d4f;box-shadow:none;}.css-16cpc8y.ant-btn-primary.ant-btn-dangerous.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):hover{background:transparent;color:#ff7875;border-color:#ff7875;}.css-16cpc8y.ant-btn-primary.ant-btn-dangerous.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):active{background:transparent;color:#d9363e;border-color:#d9363e;}.css-16cpc8y.ant-btn-primary.ant-btn-dangerous.ant-btn-background-ghost:disabled{cursor:not-allowed;color:rgba(0, 0, 0, 0.25);border-color:rgba(237,237,237, 0.6);}.css-16cpc8y.ant-btn-primary.ant-btn-dangerous:disabled,.css-16cpc8y.ant-btn-primary.ant-btn-dangerous.ant-btn-disabled{cursor:not-allowed;border-color:rgba(237,237,237, 0.6);color:rgba(0, 0, 0, 0.25);background:rgba(0, 0, 0, 0.04);box-shadow:none;}.css-16cpc8y.ant-btn-dashed{background:#ffffff;border-color:rgba(237,237,237, 0.6);color:#1b1b1b;box-shadow:0 2px 0 rgba(0, 0, 0, 0.02);border-style:dashed;}.css-16cpc8y.ant-btn-dashed:disabled,.css-16cpc8y.ant-btn-dashed.ant-btn-disabled{cursor:not-allowed;border-color:rgba(237,237,237, 0.6);color:rgba(0, 0, 0, 0.25);background:rgba(0, 0, 0, 0.04);box-shadow:none;}.css-16cpc8y.ant-btn-dashed:not(:disabled):not(.ant-btn-disabled):hover{color:#6891de;border-color:#6891de;background:#ffffff;}.css-16cpc8y.ant-btn-dashed:not(:disabled):not(.ant-btn-disabled):active{color:#2c50ab;border-color:#2c50ab;background:#ffffff;}.css-16cpc8y.ant-btn-dashed.ant-btn-background-ghost{color:#ffffff;background:transparent;border-color:#ffffff;box-shadow:none;}.css-16cpc8y.ant-btn-dashed.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):hover{background:transparent;}.css-16cpc8y.ant-btn-dashed.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):active{background:transparent;}.css-16cpc8y.ant-btn-dashed.ant-btn-background-ghost:disabled{cursor:not-allowed;color:rgba(0, 0, 0, 0.25);border-color:rgba(237,237,237, 0.6);}.css-16cpc8y.ant-btn-dashed.ant-btn-dangerous{color:#ff4d4f;border-color:#ff4d4f;}.css-16cpc8y.ant-btn-dashed.ant-btn-dangerous:not(:disabled):not(.ant-btn-disabled):hover{color:#ff7875;border-color:#ffa39e;}.css-16cpc8y.ant-btn-dashed.ant-btn-dangerous:not(:disabled):not(.ant-btn-disabled):active{color:#d9363e;border-color:#d9363e;}.css-16cpc8y.ant-btn-dashed.ant-btn-dangerous.ant-btn-background-ghost{color:#ff4d4f;background:transparent;border-color:#ff4d4f;box-shadow:none;}.css-16cpc8y.ant-btn-dashed.ant-btn-dangerous.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):hover{background:transparent;}.css-16cpc8y.ant-btn-dashed.ant-btn-dangerous.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):active{background:transparent;}.css-16cpc8y.ant-btn-dashed.ant-btn-dangerous.ant-btn-background-ghost:disabled{cursor:not-allowed;color:rgba(0, 0, 0, 0.25);border-color:rgba(237,237,237, 0.6);}.css-16cpc8y.ant-btn-dashed.ant-btn-dangerous:disabled,.css-16cpc8y.ant-btn-dashed.ant-btn-dangerous.ant-btn-disabled{cursor:not-allowed;border-color:rgba(237,237,237, 0.6);color:rgba(0, 0, 0, 0.25);background:rgba(0, 0, 0, 0.04);box-shadow:none;}.css-16cpc8y.ant-btn-link{color:#416ed2;}.css-16cpc8y.ant-btn-link:not(:disabled):not(.ant-btn-disabled):hover{color:#305ab7;background:transparent;}.css-16cpc8y.ant-btn-link:not(:disabled):not(.ant-btn-disabled):active{color:#305ab7;}.css-16cpc8y.ant-btn-link:disabled,.css-16cpc8y.ant-btn-link.ant-btn-disabled{cursor:not-allowed;color:rgba(0, 0, 0, 0.25);}.css-16cpc8y.ant-btn-link.ant-btn-dangerous{color:#ff4d4f;}.css-16cpc8y.ant-btn-link.ant-btn-dangerous:not(:disabled):not(.ant-btn-disabled):hover{color:#ff7875;}.css-16cpc8y.ant-btn-link.ant-btn-dangerous:not(:disabled):not(.ant-btn-disabled):active{color:#d9363e;}.css-16cpc8y.ant-btn-link.ant-btn-dangerous:disabled,.css-16cpc8y.ant-btn-link.ant-btn-dangerous.ant-btn-disabled{cursor:not-allowed;color:rgba(0, 0, 0, 0.25);}.css-16cpc8y.ant-btn-text:not(:disabled):not(.ant-btn-disabled):hover{color:#1b1b1b;background:rgba(0, 0, 0, 0.06);}.css-16cpc8y.ant-btn-text:not(:disabled):not(.ant-btn-disabled):active{color:#1b1b1b;background:rgba(0, 0, 0, 0.15);}.css-16cpc8y.ant-btn-text:disabled,.css-16cpc8y.ant-btn-text.ant-btn-disabled{cursor:not-allowed;color:rgba(0, 0, 0, 0.25);}.css-16cpc8y.ant-btn-text.ant-btn-dangerous{color:#ff4d4f;}.css-16cpc8y.ant-btn-text.ant-btn-dangerous:disabled,.css-16cpc8y.ant-btn-text.ant-btn-dangerous.ant-btn-disabled{cursor:not-allowed;color:rgba(0, 0, 0, 0.25);}.css-16cpc8y.ant-btn-text.ant-btn-dangerous:not(:disabled):not(.ant-btn-disabled):hover{color:#ff7875;background:#fff2f0;}.css-16cpc8y.ant-btn-text.ant-btn-dangerous:not(:disabled):not(.ant-btn-disabled):active{color:#ff7875;background:#fff2f0;}.css-16cpc8y.ant-btn-ghost.ant-btn-background-ghost{color:#ffffff;background:transparent;border-color:#ffffff;box-shadow:none;}.css-16cpc8y.ant-btn-ghost.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):hover{background:transparent;}.css-16cpc8y.ant-btn-ghost.ant-btn-background-ghost:not(:disabled):not(.ant-btn-disabled):active{background:transparent;}.css-16cpc8y.ant-btn-ghost.ant-btn-background-ghost:disabled{cursor:not-allowed;color:rgba(0, 0, 0, 0.25);border-color:rgba(237,237,237, 0.6);}.css-16cpc8y.ant-btn-group{position:relative;display:inline-flex;}.css-16cpc8y.ant-btn-group >span:not(:last-child),.css-16cpc8y.ant-btn-group >.ant-btn:not(:last-child),.css-16cpc8y.ant-btn-group >span:not(:last-child)>.ant-btn,.css-16cpc8y.ant-btn-group >.ant-btn:not(:last-child)>.ant-btn{border-top-right-radius:0;border-bottom-right-radius:0;}.css-16cpc8y.ant-btn-group >span:not(:first-child),.css-16cpc8y.ant-btn-group >.ant-btn:not(:first-child){margin-left:-1px;}.css-16cpc8y.ant-btn-group >span:not(:first-child),.css-16cpc8y.ant-btn-group >.ant-btn:not(:first-child),.css-16cpc8y.ant-btn-group >span:not(:first-child)>.ant-btn,.css-16cpc8y.ant-btn-group >.ant-btn:not(:first-child)>.ant-btn{border-top-left-radius:0;border-bottom-left-radius:0;}.css-16cpc8y.ant-btn-group .ant-btn{position:relative;z-index:1;}.css-16cpc8y.ant-btn-group .ant-btn:hover,.css-16cpc8y.ant-btn-group .ant-btn:focus,.css-16cpc8y.ant-btn-group .ant-btn:active{z-index:2;}.css-16cpc8y.ant-btn-group .ant-btn[disabled]{z-index:0;}.css-16cpc8y.ant-btn-group .ant-btn-icon-only{font-size:14px;}.css-16cpc8y.ant-btn-group >span:not(:last-child):not(:disabled),.css-16cpc8y.ant-btn-group >.ant-btn-primary:not(:last-child):not(:disabled),.css-16cpc8y.ant-btn-group >span:not(:last-child)>.ant-btn-primary:not(:disabled),.css-16cpc8y.ant-btn-group >.ant-btn-primary:not(:last-child)>.ant-btn-primary:not(:disabled){border-right-color:#6891de;}.css-16cpc8y.ant-btn-group >span:not(:first-child):not(:disabled),.css-16cpc8y.ant-btn-group >.ant-btn-primary:not(:first-child):not(:disabled),.css-16cpc8y.ant-btn-group >span:not(:first-child)>.ant-btn-primary:not(:disabled),.css-16cpc8y.ant-btn-group >.ant-btn-primary:not(:first-child)>.ant-btn-primary:not(:disabled){border-left-color:#6891de;}.css-16cpc8y.ant-btn-group >span:not(:last-child):not(:disabled),.css-16cpc8y.ant-btn-group >.ant-btn-danger:not(:last-child):not(:disabled),.css-16cpc8y.ant-btn-group >span:not(:last-child)>.ant-btn-danger:not(:disabled),.css-16cpc8y.ant-btn-group >.ant-btn-danger:not(:last-child)>.ant-btn-danger:not(:disabled){border-right-color:#ff7875;}.css-16cpc8y.ant-btn-group >span:not(:first-child):not(:disabled),.css-16cpc8y.ant-btn-group >.ant-btn-danger:not(:first-child):not(:disabled),.css-16cpc8y.ant-btn-group >span:not(:first-child)>.ant-btn-danger:not(:disabled),.css-16cpc8y.ant-btn-group >.ant-btn-danger:not(:first-child)>.ant-btn-danger:not(:disabled){border-left-color:#ff7875;}.css-16cpc8y.ant-space{display:inline-flex;}.css-16cpc8y.ant-space-rtl{direction:rtl;}.css-16cpc8y.ant-space-vertical{flex-direction:column;}.css-16cpc8y.ant-space-align{flex-direction:column;}.css-16cpc8y.ant-space-align-center{align-items:center;}.css-16cpc8y.ant-space-align-start{align-items:flex-start;}.css-16cpc8y.ant-space-align-end{align-items:flex-end;}.css-16cpc8y.ant-space-align-baseline{align-items:baseline;}.css-16cpc8y.ant-space .ant-space-item:empty{display:none;}.css-16cpc8y.ant-space .ant-space-item>.ant-badge-not-a-wrapper:only-child{display:block;}.css-16cpc8y.ant-space-gap-row-small{row-gap:8px;}.css-16cpc8y.ant-space-gap-row-middle{row-gap:16px;}.css-16cpc8y.ant-space-gap-row-large{row-gap:24px;}.css-16cpc8y.ant-space-gap-col-small{column-gap:8px;}.css-16cpc8y.ant-space-gap-col-middle{column-gap:16px;}.css-16cpc8y.ant-space-gap-col-large{column-gap:24px;}.css-16cpc8y.ant-space-block{display:flex;width:100%;}.css-16cpc8y.ant-space-vertical{flex-direction:column;}.css-16cpc8y[class^="ant-modal"],.css-16cpc8y[class*=" ant-modal"]{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';font-size:14px;box-sizing:border-box;}.css-16cpc8y[class^="ant-modal"]::before,.css-16cpc8y[class*=" ant-modal"]::before,.css-16cpc8y[class^="ant-modal"]::after,.css-16cpc8y[class*=" ant-modal"]::after{box-sizing:border-box;}.css-16cpc8y[class^="ant-modal"] [class^="ant-modal"],.css-16cpc8y[class*=" ant-modal"] [class^="ant-modal"],.css-16cpc8y[class^="ant-modal"] [class*=" ant-modal"],.css-16cpc8y[class*=" ant-modal"] [class*=" ant-modal"]{box-sizing:border-box;}.css-16cpc8y[class^="ant-modal"] [class^="ant-modal"]::before,.css-16cpc8y[class*=" ant-modal"] [class^="ant-modal"]::before,.css-16cpc8y[class^="ant-modal"] [class*=" ant-modal"]::before,.css-16cpc8y[class*=" ant-modal"] [class*=" ant-modal"]::before,.css-16cpc8y[class^="ant-modal"] [class^="ant-modal"]::after,.css-16cpc8y[class*=" ant-modal"] [class^="ant-modal"]::after,.css-16cpc8y[class^="ant-modal"] [class*=" ant-modal"]::after,.css-16cpc8y[class*=" ant-modal"] [class*=" ant-modal"]::after{box-sizing:border-box;}.css-16cpc8y.ant-modal-root .ant-modal-wrap-rtl{direction:rtl;}.css-16cpc8y.ant-modal-root .ant-modal-centered{text-align:center;}.css-16cpc8y.ant-modal-root .ant-modal-centered::before{display:inline-block;width:0;height:100%;vertical-align:middle;content:"";}.css-16cpc8y.ant-modal-root .ant-modal-centered .ant-modal{top:0;display:inline-block;padding-bottom:0;text-align:start;vertical-align:middle;}@media (max-width: 767px){.css-16cpc8y.ant-modal-root .ant-modal{max-width:calc(100vw - 16px);margin:8px auto;}.css-16cpc8y.ant-modal-root .ant-modal-centered .ant-modal{flex:1;}}.css-16cpc8y.ant-modal{box-sizing:border-box;margin:0 auto;padding:0;color:#1b1b1b;font-size:14px;line-height:1.5714285714285714;list-style:none;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';pointer-events:none;position:relative;top:100px;width:auto;max-width:calc(100vw - 32px);padding-bottom:24px;}.css-16cpc8y.ant-modal .ant-modal-title{margin:0;color:#1b1b1b;font-weight:600;font-size:16px;line-height:1.5;word-wrap:break-word;}.css-16cpc8y.ant-modal .ant-modal-content{position:relative;background-color:#ffffff;background-clip:padding-box;border:0;border-radius:8px;box-shadow:0 6px 16px 0 rgba(0, 0, 0, 0.08),0 3px 6px -4px rgba(0, 0, 0, 0.12),0 9px 28px 8px rgba(0, 0, 0, 0.05);pointer-events:auto;padding:20px 24px;}.css-16cpc8y.ant-modal .ant-modal-close{position:absolute;top:12px;right:12px;z-index:1010;padding:0;color:rgb(57,57,57);font-weight:600;line-height:1;text-decoration:none;background:transparent;border-radius:4px;width:32px;height:32px;border:0;outline:0;cursor:pointer;transition:color 0.2s,background-color 0.2s;}.css-16cpc8y.ant-modal .ant-modal-close-x{display:flex;font-size:16px;font-style:normal;line-height:32px;justify-content:center;text-transform:none;text-rendering:auto;}.css-16cpc8y.ant-modal .ant-modal-close:hover{color:#1b1b1b;background-color:rgba(0, 0, 0, 0.06);text-decoration:none;}.css-16cpc8y.ant-modal .ant-modal-close:active{background-color:rgba(0, 0, 0, 0.15);}.css-16cpc8y.ant-modal .ant-modal-close:focus-visible{outline:4px solid #c3d9f7;outline-offset:1px;transition:outline-offset 0s,outline 0s;}.css-16cpc8y.ant-modal .ant-modal-header{color:#1b1b1b;background:#ffffff;border-radius:8px 8px 0 0;margin-bottom:8px;padding:0;border-bottom:none;}.css-16cpc8y.ant-modal .ant-modal-body{font-size:14px;line-height:1.5714285714285714;word-wrap:break-word;padding:0;}.css-16cpc8y.ant-modal .ant-modal-footer{text-align:end;background:transparent;margin-top:12px;padding:0;border-top:none;border-radius:0;}.css-16cpc8y.ant-modal .ant-modal-footer >.ant-btn+.ant-btn{margin-left:8px;}.css-16cpc8y.ant-modal .ant-modal-open{overflow:hidden;}.css-16cpc8y.ant-modal-pure-panel{top:auto;padding:0;display:flex;flex-direction:column;}.css-16cpc8y.ant-modal-pure-panel .ant-modal-content,.css-16cpc8y.ant-modal-pure-panel .ant-modal-body,.css-16cpc8y.ant-modal-pure-panel .ant-modal-confirm-body-wrapper{display:flex;flex-direction:column;flex:auto;}.css-16cpc8y.ant-modal-pure-panel .ant-modal-confirm-body{margin-bottom:auto;}.css-16cpc8y.ant-modal-root .ant-modal-wrap-rtl{direction:rtl;}.css-16cpc8y.ant-modal-root .ant-modal-wrap-rtl .ant-modal-confirm-body{direction:rtl;}.css-16cpc8y.ant-modal-root .ant-modal.ant-zoom-enter,.css-16cpc8y.ant-modal-root .ant-modal.ant-zoom-appear{transform:none;opacity:0;animation-duration:0.3s;user-select:none;}.css-16cpc8y.ant-modal-root .ant-modal.ant-zoom-leave .ant-modal-content{pointer-events:none;}.css-16cpc8y.ant-modal-root .ant-modal-mask{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1000;height:100%;background-color:rgba(0, 0, 0, 0.45);pointer-events:none;}.css-16cpc8y.ant-modal-root .ant-modal-mask .ant-modal-hidden{display:none;}.css-16cpc8y.ant-modal-root .ant-modal-wrap{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1000;overflow:auto;outline:0;-webkit-overflow-scrolling:touch;}.css-16cpc8y.ant-modal-root .ant-fade-enter,.css-16cpc8y.ant-modal-root .ant-fade-appear{animation-duration:0.2s;animation-fill-mode:both;animation-play-state:paused;}.css-16cpc8y.ant-modal-root .ant-fade-leave{animation-duration:0.2s;animation-fill-mode:both;animation-play-state:paused;}.css-16cpc8y.ant-modal-root .ant-fade-enter.ant-fade-enter-active,.css-16cpc8y.ant-modal-root .ant-fade-appear.ant-fade-appear-active{animation-name:css-16cpc8y-antFadeIn;animation-play-state:running;}.css-16cpc8y.ant-modal-root .ant-fade-leave.ant-fade-leave-active{animation-name:css-16cpc8y-antFadeOut;animation-play-state:running;pointer-events:none;}.css-16cpc8y.ant-modal-root .ant-fade-enter,.css-16cpc8y.ant-modal-root .ant-fade-appear{opacity:0;animation-timing-function:linear;}.css-16cpc8y.ant-modal-root .ant-fade-leave{animation-timing-function:linear;}.css-16cpc8y.ant-zoom-enter,.css-16cpc8y.ant-zoom-appear{animation-duration:0.2s;animation-fill-mode:both;animation-play-state:paused;}.css-16cpc8y.ant-zoom-leave{animation-duration:0.2s;animation-fill-mode:both;animation-play-state:paused;}.css-16cpc8y.ant-zoom-enter.ant-zoom-enter-active,.css-16cpc8y.ant-zoom-appear.ant-zoom-appear-active{animation-name:css-16cpc8y-antZoomIn;animation-play-state:running;}.css-16cpc8y.ant-zoom-leave.ant-zoom-leave-active{animation-name:css-16cpc8y-antZoomOut;animation-play-state:running;pointer-events:none;}.css-16cpc8y.ant-zoom-enter,.css-16cpc8y.ant-zoom-appear{transform:scale(0);opacity:0;animation-timing-function:cubic-bezier(0.08, 0.82, 0.17, 1);}.css-16cpc8y.ant-zoom-enter-prepare,.css-16cpc8y.ant-zoom-appear-prepare{transform:none;}.css-16cpc8y.ant-zoom-leave{animation-timing-function:cubic-bezier(0.78, 0.14, 0.15, 0.86);}@keyframes css-16cpc8y-antFadeIn{0%{opacity:0;}100%{opacity:1;}}@keyframes css-16cpc8y-antFadeOut{0%{opacity:1;}100%{opacity:0;}}@keyframes css-16cpc8y-antZoomIn{0%{transform:scale(0.2);opacity:0;}100%{transform:scale(1);opacity:1;}}@keyframes css-16cpc8y-antZoomOut{0%{transform:scale(1);}100%{transform:scale(0.2);opacity:0;}}.css-16cpc8y.ant-typography{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';font-size:14px;box-sizing:border-box;}.css-16cpc8y.ant-typography::before,.css-16cpc8y.ant-typography::after{box-sizing:border-box;}.css-16cpc8y.ant-typography [class^="ant-typography"],.css-16cpc8y.ant-typography [class*=" ant-typography"]{box-sizing:border-box;}.css-16cpc8y.ant-typography [class^="ant-typography"]::before,.css-16cpc8y.ant-typography [class*=" ant-typography"]::before,.css-16cpc8y.ant-typography [class^="ant-typography"]::after,.css-16cpc8y.ant-typography [class*=" ant-typography"]::after{box-sizing:border-box;}.css-16cpc8y.ant-typography{color:#1b1b1b;word-break:break-word;line-height:1.5714285714285714;}.css-16cpc8y.ant-typography.ant-typography-secondary{color:rgb(57,57,57);}.css-16cpc8y.ant-typography.ant-typography-success{color:#52c41a;}.css-16cpc8y.ant-typography.ant-typography-warning{color:#faad14;}.css-16cpc8y.ant-typography.ant-typography-danger{color:#ff4d4f;}a.css-16cpc8y.ant-typography.ant-typography-danger:active,a.css-16cpc8y.ant-typography.ant-typography-danger:focus{color:#d9363e;}a.css-16cpc8y.ant-typography.ant-typography-danger:hover{color:#ff7875;}.css-16cpc8y.ant-typography.ant-typography-disabled{color:rgba(0, 0, 0, 0.25);cursor:not-allowed;user-select:none;}div.css-16cpc8y.ant-typography,.css-16cpc8y.ant-typography p{margin-bottom:1em;}h1.css-16cpc8y.ant-typography,div.css-16cpc8y.ant-typography-h1,div.css-16cpc8y.ant-typography-h1>textarea,.css-16cpc8y.ant-typography h1{margin-bottom:0.5em;color:#1b1b1b;font-weight:600;font-size:38px;line-height:1.2105263157894737;}h2.css-16cpc8y.ant-typography,div.css-16cpc8y.ant-typography-h2,div.css-16cpc8y.ant-typography-h2>textarea,.css-16cpc8y.ant-typography h2{margin-bottom:0.5em;color:#1b1b1b;font-weight:600;font-size:30px;line-height:1.2666666666666666;}h3.css-16cpc8y.ant-typography,div.css-16cpc8y.ant-typography-h3,div.css-16cpc8y.ant-typography-h3>textarea,.css-16cpc8y.ant-typography h3{margin-bottom:0.5em;color:#1b1b1b;font-weight:600;font-size:24px;line-height:1.3333333333333333;}h4.css-16cpc8y.ant-typography,div.css-16cpc8y.ant-typography-h4,div.css-16cpc8y.ant-typography-h4>textarea,.css-16cpc8y.ant-typography h4{margin-bottom:0.5em;color:#1b1b1b;font-weight:600;font-size:20px;line-height:1.4;}h5.css-16cpc8y.ant-typography,div.css-16cpc8y.ant-typography-h5,div.css-16cpc8y.ant-typography-h5>textarea,.css-16cpc8y.ant-typography h5{margin-bottom:0.5em;color:#1b1b1b;font-weight:600;font-size:16px;line-height:1.5;}.css-16cpc8y.ant-typography+h1.ant-typography,.css-16cpc8y.ant-typography+h2.ant-typography,.css-16cpc8y.ant-typography+h3.ant-typography,.css-16cpc8y.ant-typography+h4.ant-typography,.css-16cpc8y.ant-typography+h5.ant-typography{margin-top:1.2em;}.css-16cpc8y.ant-typography div +h1,.css-16cpc8y.ant-typography ul +h1,.css-16cpc8y.ant-typography li +h1,.css-16cpc8y.ant-typography p +h1,.css-16cpc8y.ant-typography h1 +h1,.css-16cpc8y.ant-typography h2 +h1,.css-16cpc8y.ant-typography h3 +h1,.css-16cpc8y.ant-typography h4 +h1,.css-16cpc8y.ant-typography h5 +h1,.css-16cpc8y.ant-typography div +h2,.css-16cpc8y.ant-typography ul +h2,.css-16cpc8y.ant-typography li +h2,.css-16cpc8y.ant-typography p +h2,.css-16cpc8y.ant-typography h1 +h2,.css-16cpc8y.ant-typography h2 +h2,.css-16cpc8y.ant-typography h3 +h2,.css-16cpc8y.ant-typography h4 +h2,.css-16cpc8y.ant-typography h5 +h2,.css-16cpc8y.ant-typography div +h3,.css-16cpc8y.ant-typography ul +h3,.css-16cpc8y.ant-typography li +h3,.css-16cpc8y.ant-typography p +h3,.css-16cpc8y.ant-typography h1 +h3,.css-16cpc8y.ant-typography h2 +h3,.css-16cpc8y.ant-typography h3 +h3,.css-16cpc8y.ant-typography h4 +h3,.css-16cpc8y.ant-typography h5 +h3,.css-16cpc8y.ant-typography div +h4,.css-16cpc8y.ant-typography ul +h4,.css-16cpc8y.ant-typography li +h4,.css-16cpc8y.ant-typography p +h4,.css-16cpc8y.ant-typography h1 +h4,.css-16cpc8y.ant-typography h2 +h4,.css-16cpc8y.ant-typography h3 +h4,.css-16cpc8y.ant-typography h4 +h4,.css-16cpc8y.ant-typography h5 +h4,.css-16cpc8y.ant-typography div +h5,.css-16cpc8y.ant-typography ul +h5,.css-16cpc8y.ant-typography li +h5,.css-16cpc8y.ant-typography p +h5,.css-16cpc8y.ant-typography h1 +h5,.css-16cpc8y.ant-typography h2 +h5,.css-16cpc8y.ant-typography h3 +h5,.css-16cpc8y.ant-typography h4 +h5,.css-16cpc8y.ant-typography h5 +h5{margin-top:1.2em;}.css-16cpc8y.ant-typography code{margin:0 0.2em;padding-left:0.4em;padding-right:0.4em;padding-top:0.2em;padding-bottom:0.1em;font-size:85%;font-family:'SFMono-Regular',Consolas,'Liberation Mono',Menlo,Courier,monospace;background:rgba(150, 150, 150, 0.1);border:1px solid rgba(100, 100, 100, 0.2);border-radius:3px;}.css-16cpc8y.ant-typography kbd{margin:0 0.2em;padding-left:0.4em;padding-right:0.4em;padding-top:0.15em;padding-bottom:0.1em;font-size:90%;font-family:'SFMono-Regular',Consolas,'Liberation Mono',Menlo,Courier,monospace;background:rgba(150, 150, 150, 0.06);border:1px solid rgba(100, 100, 100, 0.2);border-bottom-width:2px;border-radius:3px;}.css-16cpc8y.ant-typography mark{padding:0;background-color:#ffe58f;}.css-16cpc8y.ant-typography u,.css-16cpc8y.ant-typography ins{text-decoration:underline;text-decoration-skip-ink:auto;}.css-16cpc8y.ant-typography s,.css-16cpc8y.ant-typography del{text-decoration:line-through;}.css-16cpc8y.ant-typography strong{font-weight:600;}.css-16cpc8y.ant-typography ul,.css-16cpc8y.ant-typography ol{margin-left:0;margin-right:0;margin-top:0;margin-bottom:1em;padding:0;}.css-16cpc8y.ant-typography ul li,.css-16cpc8y.ant-typography ol li{margin-left:20px;margin-right:0;margin-top:0;margin-bottom:0;padding-left:4px;padding-right:0;padding-top:0;padding-bottom:0;}.css-16cpc8y.ant-typography ul{list-style-type:circle;}.css-16cpc8y.ant-typography ul ul{list-style-type:disc;}.css-16cpc8y.ant-typography ol{list-style-type:decimal;}.css-16cpc8y.ant-typography pre,.css-16cpc8y.ant-typography blockquote{margin:1em 0;}.css-16cpc8y.ant-typography pre{padding:0.4em 0.6em;white-space:pre-wrap;word-wrap:break-word;background:rgba(150, 150, 150, 0.1);border:1px solid rgba(100, 100, 100, 0.2);border-radius:3px;font-family:'SFMono-Regular',Consolas,'Liberation Mono',Menlo,Courier,monospace;}.css-16cpc8y.ant-typography pre code{display:inline;margin:0;padding:0;font-size:inherit;font-family:inherit;background:transparent;border:0;}.css-16cpc8y.ant-typography blockquote{padding-left:0.6em;padding-right:0;padding-top:0;padding-bottom:0;border-left:4px solid rgba(100, 100, 100, 0.2);opacity:0.85;}a.css-16cpc8y.ant-typography,.css-16cpc8y.ant-typography a{color:#416ed2;text-decoration:none;outline:none;cursor:pointer;transition:color 0.3s;}a.css-16cpc8y.ant-typography:focus,.css-16cpc8y.ant-typography a:focus,a.css-16cpc8y.ant-typography:hover,.css-16cpc8y.ant-typography a:hover{color:#305ab7;}a.css-16cpc8y.ant-typography:active,.css-16cpc8y.ant-typography a:active{color:#305ab7;}a.css-16cpc8y.ant-typography:active,.css-16cpc8y.ant-typography a:active,a.css-16cpc8y.ant-typography:hover,.css-16cpc8y.ant-typography a:hover{text-decoration:none;}a.css-16cpc8y.ant-typography[disabled],.css-16cpc8y.ant-typography a[disabled],a.css-16cpc8y.ant-typography.ant-typography-disabled,.css-16cpc8y.ant-typography a.ant-typography-disabled{color:rgba(0, 0, 0, 0.25);cursor:not-allowed;}a.css-16cpc8y.ant-typography[disabled]:active,.css-16cpc8y.ant-typography a[disabled]:active,a.css-16cpc8y.ant-typography.ant-typography-disabled:active,.css-16cpc8y.ant-typography a.ant-typography-disabled:active,a.css-16cpc8y.ant-typography[disabled]:hover,.css-16cpc8y.ant-typography a[disabled]:hover,a.css-16cpc8y.ant-typography.ant-typography-disabled:hover,.css-16cpc8y.ant-typography a.ant-typography-disabled:hover{color:rgba(0, 0, 0, 0.25);}a.css-16cpc8y.ant-typography[disabled]:active,.css-16cpc8y.ant-typography a[disabled]:active,a.css-16cpc8y.ant-typography.ant-typography-disabled:active,.css-16cpc8y.ant-typography a.ant-typography-disabled:active{pointer-events:none;}.css-16cpc8y.ant-typography .ant-typography-expand,.css-16cpc8y.ant-typography .ant-typography-edit,.css-16cpc8y.ant-typography .ant-typography-copy{color:#416ed2;text-decoration:none;outline:none;cursor:pointer;transition:color 0.3s;margin-left:4px;}.css-16cpc8y.ant-typography .ant-typography-expand:focus,.css-16cpc8y.ant-typography .ant-typography-edit:focus,.css-16cpc8y.ant-typography .ant-typography-copy:focus,.css-16cpc8y.ant-typography .ant-typography-expand:hover,.css-16cpc8y.ant-typography .ant-typography-edit:hover,.css-16cpc8y.ant-typography .ant-typography-copy:hover{color:#305ab7;}.css-16cpc8y.ant-typography .ant-typography-expand:active,.css-16cpc8y.ant-typography .ant-typography-edit:active,.css-16cpc8y.ant-typography .ant-typography-copy:active{color:#305ab7;}.css-16cpc8y.ant-typography-edit-content{position:relative;}div.css-16cpc8y.ant-typography-edit-content{left:-12px;margin-top:-12px;margin-bottom:calc(1em - 12px);}.css-16cpc8y.ant-typography-edit-content .ant-typography-edit-content-confirm{position:absolute;right:10px;bottom:8px;color:rgb(57,57,57);font-weight:normal;font-size:14px;font-style:normal;pointer-events:none;}.css-16cpc8y.ant-typography-edit-content textarea{margin:0!important;-moz-transition:none;height:1em;}.css-16cpc8y.ant-typography .ant-typography-copy-success,.css-16cpc8y.ant-typography .ant-typography-copy-success:hover,.css-16cpc8y.ant-typography .ant-typography-copy-success:focus{color:#52c41a;}.css-16cpc8y.ant-typography .ant-typography-copy-icon-only{margin-left:0;}a.css-16cpc8y.ant-typography-ellipsis,span.css-16cpc8y.ant-typography-ellipsis{display:inline-block;max-width:100%;}.css-16cpc8y.ant-typography-single-line{white-space:nowrap;}.css-16cpc8y.ant-typography-ellipsis-single-line{overflow:hidden;text-overflow:ellipsis;}a.css-16cpc8y.ant-typography-ellipsis-single-line,span.css-16cpc8y.ant-typography-ellipsis-single-line{vertical-align:bottom;}.css-16cpc8y.ant-typography-ellipsis-single-line >code{padding-top:0;padding-bottom:0;max-width:calc(100% - 1.2em);display:inline-block;overflow:hidden;text-overflow:ellipsis;vertical-align:bottom;box-sizing:content-box;}.css-16cpc8y.ant-typography-ellipsis-multiple-line{display:-webkit-box;overflow:hidden;-webkit-line-clamp:3;-webkit-box-orient:vertical;}.css-16cpc8y.ant-typography-rtl{direction:rtl;}.css-16cpc8y.ant-app{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';font-size:14px;box-sizing:border-box;}.css-16cpc8y.ant-app::before,.css-16cpc8y.ant-app::after{box-sizing:border-box;}.css-16cpc8y.ant-app [class^="ant-app"],.css-16cpc8y.ant-app [class*=" ant-app"]{box-sizing:border-box;}.css-16cpc8y.ant-app [class^="ant-app"]::before,.css-16cpc8y.ant-app [class*=" ant-app"]::before,.css-16cpc8y.ant-app [class^="ant-app"]::after,.css-16cpc8y.ant-app [class*=" ant-app"]::after{box-sizing:border-box;}.css-16cpc8y.ant-app{color:#1b1b1b;font-size:14px;line-height:1.5714285714285714;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';}.anticon{display:inline-flex;align-items:center;color:inherit;font-style:normal;line-height:0;text-align:center;text-transform:none;vertical-align:-0.125em;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}.anticon >*{line-height:1;}.anticon svg{display:inline-block;}.anticon .anticon .anticon-icon{display:block;}.anticon{display:inline-flex;align-items:center;color:inherit;font-style:normal;line-height:0;text-align:center;text-transform:none;vertical-align:-0.125em;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}.anticon >*{line-height:1;}.anticon svg{display:inline-block;}.anticon .anticon .anticon-icon{display:block;}:focus {
  outline: none;
}
:focus-visible {
  outline: none;
}
input::-ms-clear,
input::-ms-reveal {
  display: none;
}
*,
*::before,
*::after {
  box-sizing: border-box;
}
.container {
  margin: 0;
  text-align: left;
  font-weight: initial;
  font-family: sans-serif;
  -webkit-font-smoothing: auto;
  -moz-osx-font-smoothing: initial;
  line-height: 1.15;
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
  -ms-overflow-style: scrollbar;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
    'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji',
    'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  --cnfont:  -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, "Segoe UI", Arial, Roboto, "PingFang SC", miui, "Hiragino Sans GB", "Microsoft Yahei", sans-serif;
  --size: 20px;
  --width: 800px;
  --space: 0;
  --lineheight: 1.8;
  --weight: 400;
  --blockspace: 20px;
  --indent: 0em;
  --titlealign: left;
  --align: left;
  --imageleft: auto;
  --imageright: auto;
  --imagehide: block;
  --margin: 80px;
  --padding: 80px;
  --offsetleft: 0px;
  --offsetright: 0px;
  --columncount: 2;
  --columngap: 60px;
  --columnwidth: 90%;
  --title1: 2em;
  --title1weight: 500;
  --title1color: #1b1b1b;
  --title2: 1.6em;
  --title2weight: 500;
  --title2color: #1b1b1b;
  --title3: 1.2em;
  --title3weight: 500;
  --title3color: #1b1b1b;
  --title4: 1em;
  --title4weight: 500;
  --title4color: #1b1b1b;
  --title5: 1em;
  --title5weight: 500;
  --title5color: #1b1b1b;
  --title6: 1em;
  --title6weight: 500;
  --title6color: #1b1b1b;
  --color: #1b1b1b;
  --link: #416ed2;
  --hover: #305ab7;
  --visited: #305ab7;
  --select: #1b1b1b;
  --selectbg: #bbd6fc;
  --bg-r: 237;
  --bg-g: 237;
  --bg-b: 237;
  --bg: #ffffff;
  --canvas: #ededed;
  --track-width: 8px;
  --track: #e2e2e2;
  --thumb: #9e9e9e;
  --radius: 4px;
}
.container .ant-app {
  color:  #1b1b1b;
  font-size: var(--size);
  font-family:  -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, "Segoe UI", Arial, Roboto, "PingFang SC", miui, "Hiragino Sans GB", "Microsoft Yahei", sans-serif;
  font-weight: var(--weight);
  line-height: var(--lineheight);
  padding-left: var(--offsetleft);
  padding-right: var(--offsetright);
}
@-ms-viewport {
  width: device-width;
}
[tabindex='-1']:focus {
  outline: none;
}
hr {
  box-sizing: content-box;
  height: 0;
  overflow: visible;
}
h1,
h2,
h3,
h4,
h5,
h6 {
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 500;
}
p {
  margin-top: 0;
  margin-bottom: 1em;
}
abbr[title],
abbr[data-original-title] {
  -webkit-text-decoration: underline dotted;
  text-decoration: underline;
  text-decoration: underline dotted;
  border-bottom: 0;
  cursor: help;
}
address {
  margin-bottom: 1em;
  font-style: normal;
  line-height: inherit;
}
input[type='text'],
input[type='password'],
input[type='number'],
textarea {
  -webkit-appearance: none;
}
ol,
ul,
dl {
  margin-top: 0;
  margin-bottom: 1em;
}
ol ol,
ul ul,
ol ul,
ul ol {
  margin-bottom: 0;
}
dt {
  font-weight: 500;
}
dd {
  margin-bottom: 0.5em;
  margin-left: 0;
}
blockquote {
  margin: 0 0 1em;
}
dfn {
  font-style: italic;
}
b,
strong {
  font-weight: bolder;
}
small {
  font-size: 80%;
}
sub,
sup {
  position: relative;
  font-size: 75%;
  line-height: 0;
  vertical-align: baseline;
}
sub {
  bottom: -0.25em;
}
sup {
  top: -0.5em;
}
pre,
code,
kbd,
samp {
  font-size: 1em;
  font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
}
pre {
  margin-top: 0;
  margin-bottom: 1em;
  overflow: auto;
}
figure {
  margin: 0 0 1em;
}
img {
  vertical-align: middle;
  border-style: none;
}
a,
area,
button,
[role='button'],
input:not([type='range']),
label,
select,
summary,
textarea {
  touch-action: manipulation;
}
table {
  border-collapse: collapse;
}
caption {
  padding-top: 0.75em;
  padding-bottom: 0.3em;
  text-align: left;
  caption-side: bottom;
}
input,
button,
select,
optgroup,
textarea {
  margin: 0;
  color: inherit;
  font-size: inherit;
  font-family: inherit;
  line-height: inherit;
}
button,
input {
  overflow: visible;
}
button,
select {
  text-transform: none;
}
button,
html [type='button'],
[type='reset'],
[type='submit'] {
  -webkit-appearance: button;
}
button::-moz-focus-inner,
[type='button']::-moz-focus-inner,
[type='reset']::-moz-focus-inner,
[type='submit']::-moz-focus-inner {
  padding: 0;
  border-style: none;
}
input[type='radio'],
input[type='checkbox'] {
  box-sizing: border-box;
  padding: 0;
}
input[type='date'],
input[type='time'],
input[type='datetime-local'],
input[type='month'] {
  -webkit-appearance: listbox;
}
textarea {
  overflow: auto;
  resize: vertical;
}
fieldset {
  min-width: 0;
  margin: 0;
  padding: 0;
  border: 0;
}
legend {
  display: block;
  width: 100%;
  max-width: 100%;
  margin-bottom: 0.5em;
  padding: 0;
  color: inherit;
  font-size: 1.5em;
  line-height: inherit;
  white-space: normal;
}
progress {
  vertical-align: baseline;
}
[type='number']::-webkit-inner-spin-button,
[type='number']::-webkit-outer-spin-button {
  height: auto;
}
[type='search'] {
  outline-offset: -2px;
  -webkit-appearance: none;
}
[type='search']::-webkit-search-cancel-button,
[type='search']::-webkit-search-decoration {
  -webkit-appearance: none;
}
::-webkit-file-upload-button {
  font: inherit;
  -webkit-appearance: button;
}
output {
  display: inline-block;
}
summary {
  display: list-item;
}
template {
  display: none;
}
[hidden] {
  display: none !important;
}
mark {
  padding: 0.2em;
}

.copyright {
  line-height: normal;
  display: flex;
  align-items: center;
  flex-direction: column;
  padding-bottom: 20px;
}
.copyright .ant-btn.ant-btn-lg.ant-btn-icon-only {
  width: auto;
  height: auto;
  opacity: 0.2;
  padding: 7px 10px;
}
.copyright .ant-btn.ant-btn-lg.ant-btn-icon-only svg {
  width: 40px;
  height: 40px;
}
.copyright .ant-btn.ant-btn-lg.ant-btn-icon-only:hover {
  opacity: 1;
  background: transparent;
}
.copyright .ant-btn.ant-btn-lg.ant-btn-icon-only.like:hover {
  color: #f10606;
}
.copyright .ant-btn.ant-btn-lg.ant-btn-icon-only.unlike:hover {
  color: #e7c207;
}
.copyright .ant-btn.ant-btn-lg.ant-btn-icon-only.coffee:hover {
  color: #ce6a07;
}
.copyright .ant-btn.ant-btn-sm {
  font-size: 12px;
  opacity: 0.4;
  padding-left: 6px;
  padding-right: 6px;
  height: auto;
}
.copyright .ant-btn.ant-btn-sm:hover {
  opacity: 1;
}
.copyright .ant-typography.ant-typography-secondary {
  font-size: 12px;
  opacity: 0.5;
  margin-top: 3px;
}

.container .ant-app {
  min-height: 100vh;
}
.container a {
  text-decoration: none;
}
.container code,
.container tt {
  border-radius: 3px;
  padding: 0 5px;
  margin: 0 5px;
}
.container pre {
  padding: 0.6em 0.8em;
  word-wrap: break-word;
  border-radius: 3px;
}
.container pre code {
  display: inline;
  margin: 0;
  padding: 0;
  background: 0 0;
  border: 0;
}
.container kbd {
  margin: 0 0.2em;
  padding: 0.15em 0.4em 0.1em;
  font-size: 90%;
  border-bottom-width: 2px;
  border-radius: 3px;
}
.container blockquote {
  padding: 0.1em 1em;
  opacity: 0.85;
}
.container blockquote > :first-child {
  margin-top: 0px;
}
.container blockquote > :last-child {
  margin-bottom: 0px;
}
.container blockquote p {
  margin: 0;
}
.container hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  padding: 0;
}
.container table {
  width: 100%;
  max-width: 100%;
  border-collapse: collapse;
}
.container table pre {
  white-space: pre-wrap;
}
.container figure {
  overflow: auto;
}
.container figure > img,
.container figure > table,
.container figure > pre {
  margin: 0 !important;
}
.container tr th,
.container tr td {
  padding: 6px 13px;
}
.container tr th p {
  margin: 0;
}
.container img {
  object-fit: contain;
}
.container img,
.container video {
  max-width: 100%;
  height: auto;
}
.container embed {
  max-width: 100%;
}
.container li div,
.container li p {
  margin: 0;
}
.container mark {
  padding: 0;
  margin: 0;
  color: initial;
  background-color: initial;
}
.container :focus {
  outline: none;
}
.container [role='separator']::after {
  content: '';
  display: block;
  clear: both;
  margin: 25px 0;
  height: 2px;
  overflow: hidden;
  border: none;
  opacity: 0.1;
  background:  #1b1b1b;
  padding: 0;
}
.container [role='separator']:last-child::after {
  display: none;
}
.container .line {
  display: block;
}
.container .left {
  float: left;
  margin-right: 12px;
}
.container .right {
  float: right;
  margin-left: 12px;
}
.container .both {
  clear: both;
}
.container .full-width {
  width: 100%;
  max-width: 100% !important;
}
.container .noise {
  display: none !important;
}
.container .block {
  display: block;
}
.container .inline-block {
  display: inline-block;
}
.container .flex {
  display: flex;
  flex-wrap: wrap;
}
.container .inline-flex {
  display: inline-flex;
  flex-wrap: wrap;
}
.container .zone-width {
  min-width: 0;
}

.container {
  color:  #1b1b1b;
  background:  #ffffff;
}
.container code,
.container tt {
  border: 1px solid rgba( 237,  237,  237, 0.6);
  background: rgba( 237,  237,  237, 0.4);
}
.container pre {
  background: rgba( 237,  237,  237, 0.5);
}
.container kbd {
  border: 1px solid rgba( 237,  237,  237, 1);
}
.container blockquote {
  border-left: 4px solid rgba( 237,  237,  237, 1);
}
.container hr {
  border-bottom: 1px solid rgba( 237,  237,  237, 1);
}
.container table th:hover,
.container table tr:hover {
  background: rgba( 237,  237,  237, 0.6);
}
.container table tr {
  border-bottom: 1px solid rgba( 237,  237,  237, 0.6);
}
.container table thead tr:first-child,
.container table tbody tr:first-child {
  background: rgba( 237,  237,  237, 0.4);
}
.container table thead + tbody tr:first-child {
  background: transparent;
}
.container table tr td {
  border-inline-end: 1px solid  rgb(237, 237, 237);
}
.container h1,
.container h2,
.container h3,
.container h4,
.container h5,
.container h6 {
  color:  #1b1b1b;
}
.container a {
  color:  #416ed2;
}
.container a:hover {
  color:  #305ab7;
}
.container a:active {
  color:  #305ab7;
}
.container a:visited {
  color:  #305ab7;
}
.container ::selection {
  color:  #1b1b1b;
  background-color:  #bbd6fc;
}
.container .title a {
  color:  #1b1b1b;
}
.container .title a:hover {
  color:  #416ed2;
}
.container .footer {
  color:  #1b1b1b;
}
.container.solid {
  background:  rgb(237, 237, 237);
}

.container {
  padding: 1px;
  text-shadow: none;
  font-variant: tabular-nums;
  font-feature-settings: 'tnum';
}
.container h1 {
  font-size: var(--title1);
  color:  #1b1b1b;
  font-weight: var(--title1weight);
}
.container h2 {
  font-size: var(--title2);
  color:  #1b1b1b;
  font-weight: var(--title2weight);
}
.container h3 {
  font-size: var(--title3);
  color:  #1b1b1b;
  font-weight: var(--title3weight);
}
.container h4 {
  font-size: var(--title4);
  color:  #1b1b1b;
  font-weight: var(--title4weight);
}
.container h5 {
  font-size: var(--title5);
  color:  #1b1b1b;
  font-weight: var(--title5weight);
}
.container h6 {
  font-size: var(--title6);
  color:  #1b1b1b;
  font-weight: var(--title6weight);
}
.container h1,
.container h2,
.container h3,
.container h4,
.container h5,
.container h6 {
  text-indent: 0;
}
.container a.link {
  margin: 0 6px;
}
.container a.link-with-img {
  display: inline-block;
}
.container a.link-with-img img {
  margin: 0 !important;
}
.container ol,
.container ul {
  text-indent: 0;
}
.container pre {
  white-space: pre-wrap;
}
.container pre,
.container code,
.container blockquote {
  text-indent: 0;
  text-align: left;
}
.container p,
.container blockquote,
.container ul,
.container ol,
.container dl,
.container table,
.container pre,
.container section,
.container figcaption,
.container li,
.container .block {
  margin: var(--blockspace) 0;
}
.container table {
  width: var(--width);
  max-width: var(--width);
  border-top: 1px solid  rgb(237, 237, 237);
  border-bottom: 1px solid  rgb(237, 237, 237);
}
.container .flex p,
.container .inline-flex p,
.container .flex blockquote,
.container .inline-flex blockquote,
.container .flex ul,
.container .inline-flex ul,
.container .flex ol,
.container .inline-flex ol,
.container .flex dl,
.container .inline-flex dl,
.container .flex table,
.container .inline-flex table,
.container .flex pre,
.container .inline-flex pre,
.container .flex section,
.container .inline-flex section,
.container .flex figcaption,
.container .inline-flex figcaption,
.container .flex .block,
.container .inline-flex .block {
  margin: 0;
}
.container .flex > *,
.container .inline-flex > * {
  margin-left: 10px !important;
  margin-right: 10px !important;
}
.container .flex > *:first-child,
.container .inline-flex > *:first-child {
  margin-left: 0 !important;
}
.container .flex > *:last-child,
.container .inline-flex > *:last-child {
  margin-right: 0 !important;
}
.container .pages {
  min-height: 610px;
  max-width: var(--width);
  margin:  80px auto;
}
.container .pages svg {
  width: 20px;
  height: 20px;
}
.container .pages .MathJax_SVG svg {
  width: auto;
  height: auto;
}
.container .page {
  padding-bottom: 20px;
  margin-bottom: 20px;
  word-break: break-word;
  text-indent: var(--indent);
  letter-spacing: var(--space);
  text-align: var(--align);
}
.container .page > *:first-child {
  margin-top: 0;
}
.container .page > *:last-child {
  margin-bottom: 0;
}
.container .page:last-child {
  margin-bottom: 0;
  border-bottom-width: 0;
}
.container .page:before,
.container .page:after {
  content: '';
  display: block;
  clear: both;
  height: 0px;
}
.container .page img {
  display: var(--imagehide);
}
.container .page img.large {
  margin-top: var(--blockspace) !important;
  margin-bottom: var(--blockspace) !important;
  margin-left: var(--imageleft) !important;
  margin-right: var(--imageright) !important;
}
.container .page img.tiny,
.container .page img.base64 {
  width: auto;
}
.container .page figure {
  overflow: auto;
}
.container .page figure > img.large,
.container .page figure > table,
.container .page figure > pre {
  margin-top: 0 !important;
  margin-bottom: 0 !important;
}
.container .page figure > figcaption {
  text-align: center;
  font-size: 90%;
  opacity: 0.8;
  margin-top: 6px;
}
.container .page p > img.large,
.container .page a img {
  margin-top: 0 !important;
  margin-bottom: 0 !important;
}
.container .page .title {
  text-indent: 0;
  margin-bottom: 0;
  text-align: var(--titlealign);
}
.container .page .meta {
  font-size: 80%;
  text-indent: 0;
  text-align: var(--titlealign);
  margin: 0 0 var(--blockspace);
}
.container .page .meta > span {
  opacity: 0.7;
  position: relative;
  margin-right: 24px;
}
.container .page .meta > span.ant-avatar {
  margin-right: 2px;
}
.container .page .meta > span.ant-avatar img {
  display: block;
}
.container .page .meta > span::after {
  content: '';
  position: absolute;
  right: -12px;
  top: 47%;
  display: block;
  width: 3px;
  height: 3px;
  background:  #1b1b1b;
  border-radius: 50%;
}
.container .page .meta > span:last-child::after {
  display: none;
}
.container .page .meta.avatar .ant-avatar {
  float: left;
  opacity: 1;
  width: 46px;
  height: 46px;
  margin-right: 16px;
  background:  #ffffff;
  border-radius: 6px;
  overflow: hidden;
}
.container .page .meta.avatar .ant-avatar img {
  display: block;
}
.container .page .meta.avatar .author {
  opacity: 1;
  line-height: 1.3;
  display: block;
}
.container .page .meta.avatar .author::after {
  display: none;
}
.container .page .meta::after {
  content: '';
  display: block;
  clear: both;
}
.container .page .excerpt {
  text-indent: 0;
  border-color:  #416ed2;
  background:  rgb(237, 237, 237);
}
.container .page .excerpt p {
  font-size: 90%;
}
.container .page .cover {
  text-indent: 0;
  margin-bottom: var(--blockspace);
}
.container .page .cover .ant-image {
  width: 100%;
  background: #f5f5f5;
}
.container .page .cover img {
  margin: 0 !important;
  width: 100%;
}
.container .page .footer {
  text-indent: 0;
  margin: calc(var(--blockspace) * 2) 0 0;
}
.container .page .footer .ant-tag {
  cursor: pointer;
  min-height: 27px;
  border-radius: 15px;
  background:  #ffffff;
  padding: 3px 12px 3px 3px;
  margin: 0 5px 4px 0;
  display: inline-block;
}
.container .page .footer .ant-tag::before {
  content: '#';
  margin-right: 4px;
  background:  rgb(237, 237, 237);
  width: 20px;
  height: 20px;
  text-align: center;
  font-size: 12px;
  color:  #416ed2;
  line-height: 20px;
  border-radius: 50px;
  display: inline-block;
}
.container .page .footer .ant-tag:hover {
  color:  #1b1b1b;
  background-color:  #bbd6fc;
}
.container .page .page-empty.ant-result {
  padding: 180px 0;
}
.container .page .page-empty.ant-result .ant-result-icon svg {
  width: auto;
  height: auto;
}
.container .page.zh {
  font-family:  -apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, "Segoe UI", Arial, Roboto, "PingFang SC", miui, "Hiragino Sans GB", "Microsoft Yahei", sans-serif;
}
.container .tex,
.container .katex-display {
  text-align: center;
  margin: 50px 0;
}
.container .sub-page::before {
  content: '';
  display: block;
  height: var(--blockspace);
  border-top: 1px solid  #1b1b1b;
  opacity: 0.1;
  margin-left: calc(-1 *  80px);
  margin-right: calc(-1 *  80px);
}
.container .sub-page .sub-title {
  margin-bottom: -2px;
}
@media screen and (max-width: 600px) {
  .container .pages {
    margin: 20px 16px;
  }
}

.container.paper {
  background:  rgb(237, 237, 237);
}
.container.paper table {
  margin: var(--blockspace) calc( 80px * -1);
}
.container.paper .page {
  border-radius: 6px;
  background:  #ffffff;
  padding:  80px;
  box-shadow: 0 0 6px rgba(0, 0, 0, 0.15);
}
.container.paper .page .cover {
  margin: var(--blockspace) calc( 80px * -1);
}
.container.paper .page-block {
  padding-left:  80px;
  padding-right:  80px;
}
.container.paper .page-block .cover {
  margin: 0;
  max-width: 100%;
}
@media screen and (max-width: 600px) {
  .container.paper .page {
    padding: 20px;
  }
  .container.paper .page .cover {
    max-width: calc(100% + 40px);
    margin: -10px -20px 0;
  }
}

@media print {
  .container {
    padding-right: 0 !important;
  }
  .container .pages {
    margin: 0;
    max-width: 100%;
  }
  .container .pages pre,
  .container .pages img,
  .container .pages table {
    break-inside: avoid;
    page-break-inside: avoid;
  }
  .container .page-block {
    column-count: auto;
    margin-bottom: 0;
    padding-bottom: 0;
    padding-top: 0;
  }
  .container.paper .page {
    box-shadow: none;
  }
}

.container.shot.paper .page {
  border-radius: 0;
  box-shadow: none;
}

@-webkit-keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-transform: translate3d(0, 1600px, 0);
    transform: translate3d(0, 1600px, 0);
  }

  100% {
    opacity: 1;
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
}

@keyframes fadeIn {
  0% {
    opacity: 0;
    -webkit-transform: translate3d(0, 1600px, 0);
    transform: translate3d(0, 1600px, 0);
  }

  100% {
    opacity: 1;
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }
}

@-webkit-keyframes fadeOut {
  0% {
    opacity: 1;
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }

  100% {
    opacity: 0;
    -webkit-transform: translate3d(0, 1600px, 0);
    transform: translate3d(0, 1600px, 0);
  }
}

@keyframes fadeOut {
  0% {
    opacity: 1;
    -webkit-transform: translate3d(0, 0, 0);
    transform: translate3d(0, 0, 0);
  }

  100% {
    opacity: 0;
    -webkit-transform: translate3d(0, 1600px, 0);
    transform: translate3d(0, 1600px, 0);
  }
}

.container.in .pages {
  -webkit-animation-name: fadeIn;
  animation-name: fadeIn;
  -webkit-animation-duration: .3s;
  animation-duration: .3s;
  -webkit-animation-fill-mode: both;
  animation-fill-mode: both;
}

.container.out .pages {
  -webkit-animation-name: fadeOut;
  animation-name: fadeOut;
  -webkit-animation-duration: .2s;
  animation-duration: .2s;
  -webkit-animation-fill-mode: both;
  animation-fill-mode: both;
}

    .container {
      --codefont: inherit;
      --codesize: 20px;
      --codelineheight: 1;
      --codecomment: #697070;
      --codetag: #444a;
      --codeattr: #444a;
      --codenumber: #800;
      --codeblock: #800;
      --codevariable: #ab5656;
      --codeliteral: #695;
      --code: #397300;
      --codemeta: #1f7199;
      --codestring: #38a;
    }
    .hljs {
      border-radius: 3px;
      font-family: var(--codefont);
      font-size: var(--codesize);
      line-height: var(--codelineheight);
    }
    .hljs.large {
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      padding: 50px;
      background:  #ffffff;
      z-index: 600;
      margin: 0;
      word-break: break-word;
      overflow: auto;
      white-space: pre-wrap;
    }
    
    .hljs-comment {
      color: var(--codecomment);
    }
    .hljs-punctuation,
    .hljs-tag {
      color: var(--codetag);
    }
    .hljs-tag .hljs-attr,
    .hljs-tag .hljs-name {
      color: var(--codeattr);
    }
    .hljs-attribute,
    .hljs-doctag,
    .hljs-keyword,
    .hljs-meta .hljs-keyword,
    .hljs-name,
    .hljs-selector-tag {
      font-weight: 700;
    }
    .hljs-deletion,
    .hljs-number,
    .hljs-quote,
    .hljs-selector-class,
    .hljs-selector-id,
    .hljs-string,
    .hljs-template-tag,
    .hljs-type {
      color: var(--codenumber);
    }
    .hljs-section,
    .hljs-title {
      color: var(--codeblock);
      font-weight: 700;
    }
    .hljs-link,
    .hljs-operator,
    .hljs-regexp,
    .hljs-selector-attr,
    .hljs-selector-pseudo,
    .hljs-symbol,
    .hljs-template-variable,
    .hljs-variable {
      color: var(--codevariable);
    }
    .hljs-literal {
      color: var(--codeliteral);
    }
    .hljs-addition,
    .hljs-built_in,
    .hljs-bullet,
    .hljs-code {
      color: var(--code);
    }
    .hljs-meta {
      color: var(--codemeta);
    }
    .hljs-meta .hljs-string {
      color: var(--codestring);
    }
    .hljs-emphasis {
      font-style: italic;
    }
    .hljs-strong {
      font-weight: 700;
    }
    img[action="zoom-in"] {cursor: zoom-in;}</style><title>【WIP】llama.cpp学习之路 - Circle 阅读助手</title></head><body><div class=" container paper in"><div class="ant-app"><div class="pages"><div class="page"><h1 class="title" id="outline_0"><a href="https://www.zhihu.com/" target="_blank" rel="noreferrer">【WIP】llama.cpp学习之路</a></h1><p class="meta avatar"><span class="ant-avatar ant-avatar-circle ant-avatar-image css-16cpc8y"><img src="https://picx.zhimg.com/50/v2-9772b622f5f4dd65643830a39d4c4996_l.jpg?source=b6762063 2x" class="tiny"></span><span class="author">有没有那种一路爽到底的爽文？</span><span>2025-02-24 15:54</span><span>共 3177 字</span><span>阅读需 13.5 分钟</span></p><blockquote class="excerpt"><p>知乎，中文互联网高质量的问答社区和创作者聚集的原创内容平台，于 2011 年 1 月正式上线，以「让人们更好的分享知识、经验和见解，找到自己的解答」为品牌使命。知乎凭借认真、专业、友善的社区氛围、独特的产品机制以及结构化和易获得的优质内容，聚集了中文互联网科技、商业、影视、时尚、文化等领域最具创造力的人群，已成为综合性、全品类、在诸多领域具有关键影响力的知识分享社区和创作者聚集的原创内容平台，建立起了以社区驱动的内容变现商业模式。</p></blockquote><p></p><p><span options="[object Object]" itemprop="articleBody">SummerWine： llama.cpp介绍 llama.cpp 是一个轻量级的 C++ 实现，它用来高效地运行 LLaMA（Large Langua…</span></p><p itemprop="zhihu:question" itemtype="http://schema.org/Question"><a target="_blank" href="//www.zhihu.com/question/332890201/answer/90601139378" class="link">有没有那种一路爽到底的爽文？</a></p><p><span options="[object Object]" itemprop="text">浙三爷： 过年打牌的时候，堂哥忽然说没意思，想玩得大一点。 他把手中的宝马车钥匙往桌上一拍，问我们敢不敢跟。 我知道他只是炫耀自己买宝马了。 大家都被…</span></p><h2 id="outline_1"><span><a href="//zhuanlan.zhihu.com/p/624721308" target="_blank" rel="noopener noreferrer" class="link">高性能计算HPC岗位分享（中篇）</a></span></h2><p><span options="[object Object]" itemprop="articleBody">一休： AI&amp;芯片公司 <b>一．</b> <b>太初</b> 企业介绍： 太初元碁是由国家超级计算无锡中心孵化的高性能人工智能产业化公司， 致力于发展世界领先的自主可控高…</span></p><h2 id="outline_2"><span><a href="//zhuanlan.zhihu.com/p/25871302708" target="_blank" rel="noopener noreferrer" class="link">为什么科研需要交流</a></span></h2><p><span options="[object Object]" itemprop="articleBody">WYFhiahia： 发现一个有趣的现象： 似乎每个实验室都有那么一两个大神，热衷于聊天，不是在自己的座位上就是在别人的座位上，而且一点不耽误科研。你看…</span></p><h2 id="outline_3"><span><a href="//zhuanlan.zhihu.com/p/22298179654" target="_blank" rel="noopener noreferrer" class="link">MHA、MQA、GQA到MLA的个人理解</a></span></h2><p><a href="//www.zhihu.com/people/shi-jie-shi-wo-gai-bian-de" target="_blank" class="link-with-img"><img src="https://pica.zhimg.com/50/v2-d32d52fe0a0fd6f666f6b445fb77fed9_l.jpg?source=b6762063" class="tiny"></a></p><p><a href="//www.zhihu.com/people/shi-jie-shi-wo-gai-bian-de" target="_blank" class="link">世界是我改变的</a></p><p>想为人工智能领域及MindSpore框架添砖加瓦！</p><p>14 人赞同了该文章</p><svg width="14px" height="14px" viewBox="0 0 16 16" class="ZDI ZDI--ArrowRight16 css-z4ujak" fill="currentColor"><path fill-rule="evenodd" d="M6.252 2.328a.75.75 0 0 1 1.04.213l3.334 5.05a.75.75 0 0 1 0 .826L7.292 13.46a.75.75 0 0 1-1.251-.828L9.1 8.004 6.04 3.367a.75.75 0 0 1 .212-1.039Z" clip-rule="evenodd"></path></svg><p>Attention模块是现在几乎所有大模型的核心模块，因此也有很多工作致力于提升注意力计算的性能和效果。其中MHA（Multi-Head Attention）、MQA（Multi-Query Attention）、GQA（Grouped-Query Attention）和MLA（<b>M</b>ulti-head<b>L</b>atent<b>A</b>ttention）这一路线的思路和做法被很多主流模型所采用，因此简单地梳理一些这几个变体的思路和做法，主要是从缓存和效果上进行梳理。</p><hr><h2 id="outline_4">1. MHA</h2><h3 id="outline_5">MHA解决的问题</h3><p>说MHA（Multi-Head Attention）的话，首先得了解attention的细节，默认大家都理解attention的原理。</p><p>MHA，也就是多头注意力，在2017年就随着《Attention Is All You Need》一起提出，主要干的就是一个事：把原来一个attention计算，拆成多个小份的attention，并行计算，分别得出结果，最后再合回原来的维度。</p><p><span><span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>M</mi><mi>u</mi><mi>l</mi><mi>t</mi><mi>i</mi><mi>H</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy=&quot;false&quot;>(</mo><mi>Q</mi><mo>,</mo><mi>K</mi><mo>,</mo><mi>V</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>a</mi><mi>t</mi><mo stretchy=&quot;false&quot;>(</mo><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>h</mi></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="58.938ex" height="2.707ex" viewBox="0 -831.8 25376.1 1165.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.776ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-4D" x="0" y="0"></use><use xlink:href="#MJMATHI-75" x="1051" y="0"></use><use xlink:href="#MJMATHI-6C" x="1624" y="0"></use><use xlink:href="#MJMATHI-74" x="1922" y="0"></use><use xlink:href="#MJMATHI-69" x="2284" y="0"></use><use xlink:href="#MJMATHI-48" x="2629" y="0"></use><use xlink:href="#MJMATHI-65" x="3518" y="0"></use><use xlink:href="#MJMATHI-61" x="3984" y="0"></use><use xlink:href="#MJMATHI-64" x="4514" y="0"></use><use xlink:href="#MJMATHI-41" x="5037" y="0"></use><use xlink:href="#MJMATHI-74" x="5788" y="0"></use><use xlink:href="#MJMATHI-74" x="6149" y="0"></use><use xlink:href="#MJMATHI-65" x="6511" y="0"></use><use xlink:href="#MJMATHI-6E" x="6977" y="0"></use><use xlink:href="#MJMATHI-74" x="7578" y="0"></use><use xlink:href="#MJMATHI-69" x="7939" y="0"></use><use xlink:href="#MJMATHI-6F" x="8285" y="0"></use><use xlink:href="#MJMATHI-6E" x="8770" y="0"></use><use xlink:href="#MJMAIN-28" x="9371" y="0"></use><use xlink:href="#MJMATHI-51" x="9760" y="0"></use><use xlink:href="#MJMAIN-2C" x="10552" y="0"></use><use xlink:href="#MJMATHI-4B" x="10997" y="0"></use><use xlink:href="#MJMAIN-2C" x="11886" y="0"></use><use xlink:href="#MJMATHI-56" x="12331" y="0"></use><use xlink:href="#MJMAIN-29" x="13101" y="0"></use><use xlink:href="#MJMAIN-3D" x="13768" y="0"></use><use xlink:href="#MJMATHI-63" x="14824" y="0"></use><use xlink:href="#MJMATHI-6F" x="15258" y="0"></use><use xlink:href="#MJMATHI-6E" x="15743" y="0"></use><use xlink:href="#MJMATHI-63" x="16344" y="0"></use><use xlink:href="#MJMATHI-61" x="16777" y="0"></use><use xlink:href="#MJMATHI-74" x="17307" y="0"></use><use xlink:href="#MJMAIN-28" x="17668" y="0"></use><use xlink:href="#MJMATHI-68" x="18058" y="0"></use><use xlink:href="#MJMATHI-65" x="18634" y="0"></use><use xlink:href="#MJMATHI-61" x="19101" y="0"></use><g transform="translate(19630,0)"><use xlink:href="#MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="736" y="-213"></use></g><use xlink:href="#MJMAIN-2C" x="20605" y="0"></use><use xlink:href="#MJMAIN-2E" x="21050" y="0"></use><use xlink:href="#MJMAIN-2E" x="21495" y="0"></use><use xlink:href="#MJMAIN-2E" x="21940" y="0"></use><use xlink:href="#MJMATHI-68" x="22385" y="0"></use><use xlink:href="#MJMATHI-65" x="22962" y="0"></use><use xlink:href="#MJMATHI-61" x="23428" y="0"></use><g transform="translate(23958,0)"><use xlink:href="#MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-68" x="736" y="-213"></use></g><use xlink:href="#MJMAIN-29" x="24986" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>M</mi><mi>u</mi><mi>l</mi><mi>t</mi><mi>i</mi><mi>H</mi><mi>e</mi><mi>a</mi><mi>d</mi><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">(</mo><mi>Q</mi><mo>,</mo><mi>K</mi><mo>,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mi>c</mi><mi>o</mi><mi>n</mi><mi>c</mi><mi>a</mi><mi>t</mi><mo stretchy="false">(</mo><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>h</mi></mrow></msub><mo stretchy="false">)</mo></math></span></span><span class="tex2jax_ignore math-holder">MultiHeadAttention(Q, K, V) = concat(head_{1},...head_{h}) </span></span></span> </p><p><span><span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow></msub><mo>=</mo><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy=&quot;false&quot;>(</mo><msubsup><mi>W</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>Q</mi></mrow></msubsup><mi>Q</mi><mo>,</mo><mi>W</mi><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>K</mi></mrow></msup><mi>K</mi><mo>,</mo><mi>W</mi><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>V</mi></mrow></msup><mi>V</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="42.097ex" height="3.35ex" viewBox="0 -1053 18125.2 1442.3" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.904ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-68" x="0" y="0"></use><use xlink:href="#MJMATHI-65" x="576" y="0"></use><use xlink:href="#MJMATHI-61" x="1043" y="0"></use><g transform="translate(1572,0)"><use xlink:href="#MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="736" y="-213"></use></g><use xlink:href="#MJMAIN-3D" x="2715" y="0"></use><use xlink:href="#MJMATHI-41" x="3771" y="0"></use><use xlink:href="#MJMATHI-74" x="4521" y="0"></use><use xlink:href="#MJMATHI-74" x="4883" y="0"></use><use xlink:href="#MJMATHI-65" x="5244" y="0"></use><use xlink:href="#MJMATHI-6E" x="5711" y="0"></use><use xlink:href="#MJMATHI-74" x="6311" y="0"></use><use xlink:href="#MJMATHI-69" x="6673" y="0"></use><use xlink:href="#MJMATHI-6F" x="7018" y="0"></use><use xlink:href="#MJMATHI-6E" x="7504" y="0"></use><use xlink:href="#MJMAIN-28" x="8104" y="0"></use><g transform="translate(8494,0)"><use xlink:href="#MJMATHI-57" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-51" x="1526" y="682"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="1335" y="-430"></use></g><use xlink:href="#MJMATHI-51" x="10233" y="0"></use><use xlink:href="#MJMAIN-2C" x="11025" y="0"></use><use xlink:href="#MJMATHI-57" x="11470" y="0"></use><g transform="translate(12518,0)"><use xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-4B" x="488" y="550"></use></g><use xlink:href="#MJMATHI-4B" x="13593" y="0"></use><use xlink:href="#MJMAIN-2C" x="14482" y="0"></use><use xlink:href="#MJMATHI-57" x="14928" y="0"></use><g transform="translate(15976,0)"><use xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-56" x="488" y="550"></use></g><use xlink:href="#MJMATHI-56" x="16966" y="0"></use><use xlink:href="#MJMAIN-29" x="17735" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></msub><mo>=</mo><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">(</mo><msubsup><mi>W</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>Q</mi></mrow></msubsup><mi>Q</mi><mo>,</mo><mi>W</mi><msup><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>K</mi></mrow></msup><mi>K</mi><mo>,</mo><mi>W</mi><msup><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>V</mi></mrow></msup><mi>V</mi><mo stretchy="false">)</mo></math></span></span><span class="tex2jax_ignore math-holder">head_{i} = Attention(W_{i}^{Q}Q,W{i}^{K}K,W{i}^{V}V)</span></span></span> </p><p>假设原来模型的hidden size是 <span><span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.216ex" height="2.065ex" viewBox="0 -776.4 523.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-64" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi></math></span></span><span class="tex2jax_ignore math-holder">d </span></span></span> ，在MHA中，会把投影后的 <span><span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.45ex" viewBox="0 -776.4 791.5 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.647ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-51" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><span class="tex2jax_ignore math-holder">Q</span></span></span> 、 <span><span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.066ex" height="2.065ex" viewBox="0 -776.4 889.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-4B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>K</mi></math></span></span><span class="tex2jax_ignore math-holder">K</span></span></span> 、 <span><span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.787ex" height="2.065ex" viewBox="0 -776.4 769.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-56" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math></span></span><span class="tex2jax_ignore math-holder">V</span></span></span> 在hidden state的维度上切成 <span><span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi><mi>u</mi><mi>m</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.463ex" height="2.322ex" viewBox="0 -776.4 3643.6 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.519ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-68" x="0" y="0"></use><use xlink:href="#MJMATHI-65" x="576" y="0"></use><use xlink:href="#MJMATHI-61" x="1043" y="0"></use><g transform="translate(1572,0)"><use xlink:href="#MJMATHI-64" x="0" y="0"></use><g transform="translate(520,-150)"><use transform="scale(0.707)" xlink:href="#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-75" x="600" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-6D" x="1173" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>n</mi><mi>u</mi><mi>m</mi></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">head_{num}</span></span></span> 份，每个头的维度是 <span><span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.883ex" height="2.322ex" viewBox="0 -776.4 2102.6 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.519ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-64" x="0" y="0"></use><g transform="translate(520,-150)"><use transform="scale(0.707)" xlink:href="#MJMATHI-68" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-65" x="576" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-61" x="1043" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-64" x="1572" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">d_{head}</span></span></span> .这组小Q、K、V分别独立地进行attention计算，之后把得到的 <span><span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi><mi>u</mi><mi>m</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.463ex" height="2.322ex" viewBox="0 -776.4 3643.6 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.519ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-68" x="0" y="0"></use><use xlink:href="#MJMATHI-65" x="576" y="0"></use><use xlink:href="#MJMATHI-61" x="1043" y="0"></use><g transform="translate(1572,0)"><use xlink:href="#MJMATHI-64" x="0" y="0"></use><g transform="translate(520,-150)"><use transform="scale(0.707)" xlink:href="#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-75" x="600" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-6D" x="1173" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>h</mi><mi>e</mi><mi>a</mi><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>n</mi><mi>u</mi><mi>m</mi></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">head_{num}</span></span></span> 份维度 <span><span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.883ex" height="2.322ex" viewBox="0 -776.4 2102.6 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.519ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-64" x="0" y="0"></use><g transform="translate(520,-150)"><use transform="scale(0.707)" xlink:href="#MJMATHI-68" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-65" x="576" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-61" x="1043" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-64" x="1572" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">d_{head}</span></span></span> 的输出concat起来。</p><p>直接看这个amazing的图，很直观：</p><p><img src="https://pic2.zhimg.com/v2-d2dcc298e8c458a26cf5b490364173fb_r.jpg" class="large"></p><p>操作是这么个操作，多头注意力相比单头有什么好处呢？</p><p>《Attention Is All You Need》文章中给出的说法是：</p><blockquote>Multi-head attention allows the model to jointly attend to information from different representation subspaces at different positions.</blockquote><p>我们希望多个头能够在训练中学会注意到不同的内容。例如在翻译任务里，一些attention head可以关注语法特征，另一些attention head可以关注单词特性。这样模型就可以从不同角度来分析和理解输入信息，获得更好的效果了。</p><p>知乎上这篇文章里对此做了一些实验和分析。简单来说就是（1）每个头确实学到东西有所不同，但大部分头之间的差异没有我们想的那么大（比如一个学句法，一个学词义这样明显的区分）（2）多个头的情况下，确实有少部分头可以比较好地捕捉到各种文本信息，而不会过分关注自身位置，一定程度缓解了上文提到的计算 <span><span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi><msup><mi>K</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>T</mi></mrow></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.322ex" height="2.836ex" viewBox="0 -942.4 2291.2 1221" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.647ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-51" x="0" y="0"></use><g transform="translate(791,0)"><use xlink:href="#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-54" x="1274" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi><msup><mi>K</mi><mrow class="MJX-TeXAtom-ORD"><mi>T</mi></mrow></msup></math></span></span><span class="tex2jax_ignore math-holder">QK^{T}</span></span></span> 之后对角线元素过大的问题。</p><p>我们可以把MHA的多个attention计算视为多个独立的小模型，那么最终整体的attention计算相当于把来自多个小模型的结果进行了融合，这样效果比较好也是比较符合直觉的。</p><p>另外还有一个问题是，使用几个头比较好呢？</p><p>实际上这个问题比较难有确定性的答案，首先可以确定的是头的数量不是越多约好（毕竟头的数量多了，各个子空间小了，子空间能表达的内容就少了），具体多少要视模型规模，任务而定。另外《Are Sixteen Heads Really Better than One?》中也指出MHA并不总是优于单头的情况。</p><p>由于这里只考虑了主流的自回归LLM所用的Causal Attention，因此在token by token递归生成时，新预测出来的第 <span><span><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi><mo>+</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.805ex" height="2.193ex" viewBox="0 -776.4 2068.9 944.4" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.39ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-69" x="0" y="0"></use><use xlink:href="#MJMAIN-2B" x="567" y="0"></use><use xlink:href="#MJMAIN-31" x="1568" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>+</mo><mn>1</mn></math></span></span><span class="tex2jax_ignore math-holder">i+1</span></span></span> 个token，并不会影响到已经算好的 <span><span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>k</mi><mo>&amp;#x2264;</mo></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow><mo>,</mo><msub><mi>v</mi><mo>&amp;#x2264;</mo></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.999ex" height="2.579ex" viewBox="0 -776.4 3444.1 1110.3" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.776ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2264" x="737" y="-213"></use><use xlink:href="#MJMATHI-69" x="1171" y="0"></use><use xlink:href="#MJMAIN-2C" x="1517" y="0"></use><g transform="translate(1962,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2264" x="686" y="-213"></use></g><use xlink:href="#MJMATHI-69" x="3098" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>k</mi><mo>≤</mo></msub><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow><mo>,</mo><msub><mi>v</mi><mo>≤</mo></msub><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></math></span></span><span class="tex2jax_ignore math-holder">k_\leq{i},v_\leq{i}</span></span></span> ，因此这部分结果我们可以缓存下来供后续生成调用，避免不必要的重复计算，这就是所谓的KV Cache。</p><h3 id="outline_6">解码中的KV Cache</h3><p>后面的MQA、GQA、MLA，都是围绕“如何减少KV Cache同时尽可能地保证效果”这个主题发展而来的产物。</p><p>无论是encoder-decoder结构，还是现在我们最接近AGI的decoder-only的LLM，解码生成时都是自回归auto-regressive的方式。也就是，解码的时候，先根据当前输入 <span><span><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><msub><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.436ex" height="2.322ex" viewBox="0 -721.1 3632.2 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.647ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-69" x="0" y="0"></use><use xlink:href="#MJMATHI-6E" x="345" y="0"></use><use xlink:href="#MJMATHI-70" x="946" y="0"></use><use xlink:href="#MJMATHI-75" x="1449" y="0"></use><g transform="translate(2022,0)"><use xlink:href="#MJMATHI-74" x="0" y="0"></use><g transform="translate(361,-150)"><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2212" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="1124" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">input_{i-1}</span></span></span> ，生成下一个 <span><span><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi><mi>o</mi><mi>k</mi><mi>e</mi><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.456ex" height="2.322ex" viewBox="0 -776.4 2779.8 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.519ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-74" x="0" y="0"></use><use xlink:href="#MJMATHI-6F" x="361" y="0"></use><use xlink:href="#MJMATHI-6B" x="847" y="0"></use><use xlink:href="#MJMATHI-65" x="1368" y="0"></use><g transform="translate(1835,0)"><use xlink:href="#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="849" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>o</mi><mi>k</mi><mi>e</mi><msub><mi>n</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">token_{i}</span></span></span> ，然后把新生成的 <span><span><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi><mi>o</mi><mi>k</mi><mi>e</mi><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.456ex" height="2.322ex" viewBox="0 -776.4 2779.8 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.519ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-74" x="0" y="0"></use><use xlink:href="#MJMATHI-6F" x="361" y="0"></use><use xlink:href="#MJMATHI-6B" x="847" y="0"></use><use xlink:href="#MJMATHI-65" x="1368" y="0"></use><g transform="translate(1835,0)"><use xlink:href="#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="849" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>o</mi><mi>k</mi><mi>e</mi><msub><mi>n</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">token_{i}</span></span></span> 拼接到 <span><span><span class="MathJax_SVG" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><msub><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>&amp;#x2212;</mo><mn>1</mn></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.436ex" height="2.322ex" viewBox="0 -721.1 3632.2 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.647ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-69" x="0" y="0"></use><use xlink:href="#MJMATHI-6E" x="345" y="0"></use><use xlink:href="#MJMATHI-70" x="946" y="0"></use><use xlink:href="#MJMATHI-75" x="1449" y="0"></use><g transform="translate(2022,0)"><use xlink:href="#MJMATHI-74" x="0" y="0"></use><g transform="translate(361,-150)"><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2212" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="1124" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">input_{i-1}</span></span></span> 后面，获得新的输入 <span><span><span class="MathJax_SVG" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><msub><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.336ex" height="2.322ex" viewBox="0 -721.1 2727.8 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.647ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-69" x="0" y="0"></use><use xlink:href="#MJMATHI-6E" x="345" y="0"></use><use xlink:href="#MJMATHI-70" x="946" y="0"></use><use xlink:href="#MJMATHI-75" x="1449" y="0"></use><g transform="translate(2022,0)"><use xlink:href="#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="511" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">input_{i}</span></span></span> ，再用 <span><span><span class="MathJax_SVG" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><msub><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.336ex" height="2.322ex" viewBox="0 -721.1 2727.8 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.647ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-69" x="0" y="0"></use><use xlink:href="#MJMATHI-6E" x="345" y="0"></use><use xlink:href="#MJMATHI-70" x="946" y="0"></use><use xlink:href="#MJMATHI-75" x="1449" y="0"></use><g transform="translate(2022,0)"><use xlink:href="#MJMATHI-74" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="511" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mi>n</mi><mi>p</mi><mi>u</mi><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">input_{i}</span></span></span> 生成 <span><span><span class="MathJax_SVG" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>t</mi><mi>o</mi><mi>k</mi><mi>e</mi><msub><mi>n</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.557ex" height="2.45ex" viewBox="0 -776.4 3684.2 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.647ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-74" x="0" y="0"></use><use xlink:href="#MJMATHI-6F" x="361" y="0"></use><use xlink:href="#MJMATHI-6B" x="847" y="0"></use><use xlink:href="#MJMATHI-65" x="1368" y="0"></use><g transform="translate(1835,0)"><use xlink:href="#MJMATHI-6E" x="0" y="0"></use><g transform="translate(600,-150)"><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2B" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="1124" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mi>o</mi><mi>k</mi><mi>e</mi><msub><mi>n</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">token_{i+1}</span></span></span> ，依此迭代，直到生成结束。</p><p>比如我们输入“窗前明月光下一句是”，那么模型每次生成一个token，输入输出会是这样（方便起见，默认每个token都是一个字符）</p><div><pre class="notranslate hljs language-inform7" data-highlighted="yes">step0: 输入=<span class="hljs-comment">[BOS]</span>窗前明月光下一句是；输出=疑
step1: 输入=<span class="hljs-comment">[BOS]</span>窗前明月光下一句是疑；输出=是
step2: 输入=<span class="hljs-comment">[BOS]</span>窗前明月光下一句是疑是；输出=地
step3: 输入=<span class="hljs-comment">[BOS]</span>窗前明月光下一句是疑是地；输出=上
step4: 输入=<span class="hljs-comment">[BOS]</span>窗前明月光下一句是疑是地上；输出=霜
step5: 输入=<span class="hljs-comment">[BOS]</span>窗前明月光下一句是疑是地上霜；输出=<span class="hljs-comment">[EOS]</span></pre></div><p>（其中[BOS]和[EOS]分别是起始符号和终止符号）</p><p>仔细想一下，我们在生成“疑”字的时候，用的是输入序列中“是”字的最后一层hidden state，通过最后的分类头预测出来的。以此类推，后面每生成一个字，使用的都是输入序列中最后一个字的输出。</p><p>我们可以注意到，下一个step的输入其实包含了上一个step的内容，而且只在最后面多了一点点（一个token）。那么下一个step的计算应该也包含了上一个step的计算。</p><p>从公式上来看是这样的：</p><p>回想一下我们attention的计算</p><p><span><span><span class="MathJax_SVG" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>q</mi><mi>i</mi></msub><msubsup><mi>k</mi><mi>j</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>T</mi></mrow></msubsup><mo stretchy=&quot;false&quot;>)</mo><msub><mi>o</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow></msub><mo>=</mo><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi></mrow></munderover><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>x</mi></mrow><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><msub><mi>v</mi><mi>j</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="39.369ex" height="3.735ex" viewBox="0 -1053 16950.6 1608.2" role="img" focusable="false" aria-hidden="true" style="vertical-align: -1.289ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-6A" x="624" y="0"></use></g><use xlink:href="#MJMAIN-3D" x="1751" y="0"></use><use xlink:href="#MJMATHI-73" x="2807" y="0"></use><use xlink:href="#MJMATHI-6F" x="3276" y="0"></use><use xlink:href="#MJMATHI-66" x="3762" y="0"></use><use xlink:href="#MJMATHI-74" x="4312" y="0"></use><use xlink:href="#MJMATHI-6D" x="4674" y="0"></use><use xlink:href="#MJMATHI-61" x="5552" y="0"></use><use xlink:href="#MJMATHI-78" x="6082" y="0"></use><use xlink:href="#MJMAIN-28" x="6654" y="0"></use><g transform="translate(7044,0)"><use xlink:href="#MJMATHI-71" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="631" y="-213"></use></g><g transform="translate(7835,0)"><use xlink:href="#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-54" x="737" y="488"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-6A" x="737" y="-430"></use></g><use xlink:href="#MJMAIN-29" x="8954" y="0"></use><g transform="translate(9344,0)"><use xlink:href="#MJMATHI-6F" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="686" y="-213"></use></g><use xlink:href="#MJMAIN-3D" x="10452" y="0"></use><g transform="translate(11508,0)"><use xlink:href="#MJSZ1-2211" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="1494" y="675"></use><g transform="translate(1056,-287)"><use transform="scale(0.707)" xlink:href="#MJMATHI-6A" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-3D" x="412" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="1191" y="0"></use></g></g><use xlink:href="#MJMATHI-78" x="14027" y="0"></use><g transform="translate(14600,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-6A" x="624" y="0"></use></g></g><g transform="translate(16073,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-6A" x="686" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><mo>=</mo><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><msub><mi>q</mi><mi>i</mi></msub><msubsup><mi>k</mi><mi>j</mi><mrow class="MJX-TeXAtom-ORD"><mi>T</mi></mrow></msubsup><mo stretchy="false">)</mo><msub><mi>o</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></msub><mo>=</mo><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>j</mi><mo>=</mo><mn>0</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>i</mi></mrow></munderover><mrow class="MJX-TeXAtom-ORD"><mi>x</mi></mrow><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>,</mo><mi>j</mi></mrow></msub><msub><mi>v</mi><mi>j</mi></msub></math></span></span><span class="tex2jax_ignore math-holder">\alpha_{i,j} = softmax(q_ik_j^{T})o_{i} = \sum_{j=0}^{i}{x}\alpha_{i,j} v_j</span></span></span> </p><p>注意对于decoder的时候，由于mask attention的存在，每个输入只能看到自己和前面的内容，而看不到后面的内容</p><p>假设我们当前输入的长度是3，预测第4个字，那每层attention所做的计算有</p><p><span><span><span class="MathJax_SVG" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>o</mi><mn>0</mn></msub><mo>=</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>0</mn><mo>,</mo><mn>0</mn></mrow></msub><mo>+</mo><msub><mi>v</mi><mn>0</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.124ex" height="2.45ex" viewBox="0 -665.8 6081.1 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.904ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-6F" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="686" y="-213"></use><use xlink:href="#MJMAIN-3D" x="1217" y="0"></use><g transform="translate(2273,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="779" y="0"></use></g></g><use xlink:href="#MJMAIN-2B" x="4140" y="0"></use><g transform="translate(5141,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="686" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>o</mi><mn>0</mn></msub><mo>=</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>0</mn><mo>,</mo><mn>0</mn></mrow></msub><mo>+</mo><msub><mi>v</mi><mn>0</mn></msub></math></span></span><span class="tex2jax_ignore math-holder">o_0 = \alpha_{0,0} + v_0</span></span></span> </p><p><span><span><span class="MathJax_SVG" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>o</mi><mn>1</mn></msub><mo>=</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>,</mo><mn>0</mn></mrow></msub><msub><mi>v</mi><mn>0</mn></msub><mo>+</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>,</mo><mn>1</mn></mrow></msub><msub><mi>v</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="20.127ex" height="2.45ex" viewBox="0 -665.8 8665.7 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.904ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-6F" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="686" y="-213"></use><use xlink:href="#MJMAIN-3D" x="1217" y="0"></use><g transform="translate(2273,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="779" y="0"></use></g></g><g transform="translate(3918,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="686" y="-213"></use></g><use xlink:href="#MJMAIN-2B" x="5080" y="0"></use><g transform="translate(6081,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="779" y="0"></use></g></g><g transform="translate(7726,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="686" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>o</mi><mn>1</mn></msub><mo>=</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>,</mo><mn>0</mn></mrow></msub><msub><mi>v</mi><mn>0</mn></msub><mo>+</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>,</mo><mn>1</mn></mrow></msub><msub><mi>v</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">o_1 = \alpha_{1,0}v_0 + \alpha_{1,1}v_{1}</span></span></span> </p><p><span><span><span class="MathJax_SVG" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>o</mi><mn>2</mn></msub><mo>=</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn><mo>,</mo><mn>0</mn></mrow></msub><msub><mi>v</mi><mn>0</mn></msub><mo>+</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn><mo>,</mo><mn>1</mn></mrow></msub><msub><mi>v</mi><mn>1</mn></msub><mo>+</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn><mo>,</mo><mn>2</mn></mrow></msub><msub><mi>v</mi><mn>2</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.97ex" height="2.45ex" viewBox="0 -665.8 12473.3 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.904ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-6F" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="686" y="-213"></use><use xlink:href="#MJMAIN-3D" x="1217" y="0"></use><g transform="translate(2273,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="779" y="0"></use></g></g><g transform="translate(3918,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="686" y="-213"></use></g><use xlink:href="#MJMAIN-2B" x="5080" y="0"></use><g transform="translate(6081,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="779" y="0"></use></g></g><g transform="translate(7726,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="686" y="-213"></use></g><use xlink:href="#MJMAIN-2B" x="8887" y="0"></use><g transform="translate(9888,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="779" y="0"></use></g></g><g transform="translate(11533,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="686" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>o</mi><mn>2</mn></msub><mo>=</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn><mo>,</mo><mn>0</mn></mrow></msub><msub><mi>v</mi><mn>0</mn></msub><mo>+</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn><mo>,</mo><mn>1</mn></mrow></msub><msub><mi>v</mi><mn>1</mn></msub><mo>+</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn><mo>,</mo><mn>2</mn></mrow></msub><msub><mi>v</mi><mn>2</mn></msub></math></span></span><span class="tex2jax_ignore math-holder">o_2 = \alpha_{2,0}v_0 + \alpha_{2,1}v_1+\alpha_{2,2}v_2</span></span></span> </p><p>预测完第4个字，放到输入里，继续预测第5个字，每层attention所做的计算有</p><p><span><span><span class="MathJax_SVG" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>o</mi><mn>0</mn></msub><mo>=</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>0</mn><mo>,</mo><mn>0</mn></mrow></msub><mo>+</mo><msub><mi>v</mi><mn>0</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.124ex" height="2.45ex" viewBox="0 -665.8 6081.1 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.904ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-6F" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="686" y="-213"></use><use xlink:href="#MJMAIN-3D" x="1217" y="0"></use><g transform="translate(2273,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="779" y="0"></use></g></g><use xlink:href="#MJMAIN-2B" x="4140" y="0"></use><g transform="translate(5141,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="686" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>o</mi><mn>0</mn></msub><mo>=</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>0</mn><mo>,</mo><mn>0</mn></mrow></msub><mo>+</mo><msub><mi>v</mi><mn>0</mn></msub></math></span></span><span class="tex2jax_ignore math-holder">o_0 = \alpha_{0,0} + v_0</span></span></span> </p><p><span><span><span class="MathJax_SVG" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>o</mi><mn>1</mn></msub><mo>=</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>,</mo><mn>0</mn></mrow></msub><msub><mi>v</mi><mn>0</mn></msub><mo>+</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>,</mo><mn>1</mn></mrow></msub><msub><mi>v</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="20.127ex" height="2.45ex" viewBox="0 -665.8 8665.7 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.904ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-6F" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="686" y="-213"></use><use xlink:href="#MJMAIN-3D" x="1217" y="0"></use><g transform="translate(2273,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="779" y="0"></use></g></g><g transform="translate(3918,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="686" y="-213"></use></g><use xlink:href="#MJMAIN-2B" x="5080" y="0"></use><g transform="translate(6081,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="779" y="0"></use></g></g><g transform="translate(7726,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="686" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>o</mi><mn>1</mn></msub><mo>=</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>,</mo><mn>0</mn></mrow></msub><msub><mi>v</mi><mn>0</mn></msub><mo>+</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>,</mo><mn>1</mn></mrow></msub><msub><mi>v</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">o_1 = \alpha_{1,0}v_0 + \alpha_{1,1}v_{1}</span></span></span> </p><p><span><span><span class="MathJax_SVG" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>o</mi><mn>2</mn></msub><mo>=</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn><mo>,</mo><mn>0</mn></mrow></msub><msub><mi>v</mi><mn>0</mn></msub><mo>+</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn><mo>,</mo><mn>1</mn></mrow></msub><msub><mi>v</mi><mn>1</mn></msub><mo>+</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn><mo>,</mo><mn>2</mn></mrow></msub><msub><mi>v</mi><mn>2</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.97ex" height="2.45ex" viewBox="0 -665.8 12473.3 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.904ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-6F" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="686" y="-213"></use><use xlink:href="#MJMAIN-3D" x="1217" y="0"></use><g transform="translate(2273,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="779" y="0"></use></g></g><g transform="translate(3918,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="686" y="-213"></use></g><use xlink:href="#MJMAIN-2B" x="5080" y="0"></use><g transform="translate(6081,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="779" y="0"></use></g></g><g transform="translate(7726,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="686" y="-213"></use></g><use xlink:href="#MJMAIN-2B" x="8887" y="0"></use><g transform="translate(9888,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="779" y="0"></use></g></g><g transform="translate(11533,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="686" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>o</mi><mn>2</mn></msub><mo>=</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn><mo>,</mo><mn>0</mn></mrow></msub><msub><mi>v</mi><mn>0</mn></msub><mo>+</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn><mo>,</mo><mn>1</mn></mrow></msub><msub><mi>v</mi><mn>1</mn></msub><mo>+</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>2</mn><mo>,</mo><mn>2</mn></mrow></msub><msub><mi>v</mi><mn>2</mn></msub></math></span></span><span class="tex2jax_ignore math-holder">o_2 = \alpha_{2,0}v_0 + \alpha_{2,1}v_1+\alpha_{2,2}v_2</span></span></span> </p><p><span><span><span class="MathJax_SVG" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>o</mi><mn>3</mn></msub><mo>=</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>3</mn><mo>,</mo><mn>0</mn></mrow></msub><msub><mi>v</mi><mn>0</mn></msub><mo>+</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>3</mn><mo>,</mo><mn>1</mn></mrow></msub><msub><mi>v</mi><mn>1</mn></msub><mo>+</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>3</mn><mo>,</mo><mn>2</mn></mrow></msub><msub><mi>v</mi><mn>2</mn></msub><mo>+</mo><msub><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>3</mn><mo>,</mo><mn>3</mn></mrow></msub><msub><mi>v</mi><mn>3</mn></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="37.814ex" height="2.45ex" viewBox="0 -665.8 16280.9 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.904ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-6F" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-33" x="686" y="-213"></use><use xlink:href="#MJMAIN-3D" x="1217" y="0"></use><g transform="translate(2273,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-33" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="779" y="0"></use></g></g><g transform="translate(3918,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-30" x="686" y="-213"></use></g><use xlink:href="#MJMAIN-2B" x="5080" y="0"></use><g transform="translate(6081,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-33" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="779" y="0"></use></g></g><g transform="translate(7726,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="686" y="-213"></use></g><use xlink:href="#MJMAIN-2B" x="8887" y="0"></use><g transform="translate(9888,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-33" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="779" y="0"></use></g></g><g transform="translate(11533,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-32" x="686" y="-213"></use></g><use xlink:href="#MJMAIN-2B" x="12695" y="0"></use><g transform="translate(13696,0)"><use xlink:href="#MJMATHI-3B1" x="0" y="0"></use><g transform="translate(640,-150)"><use transform="scale(0.707)" xlink:href="#MJMAIN-33" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-2C" x="500" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-33" x="779" y="0"></use></g></g><g transform="translate(15341,0)"><use xlink:href="#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMAIN-33" x="686" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>o</mi><mn>3</mn></msub><mo>=</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>3</mn><mo>,</mo><mn>0</mn></mrow></msub><msub><mi>v</mi><mn>0</mn></msub><mo>+</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>3</mn><mo>,</mo><mn>1</mn></mrow></msub><msub><mi>v</mi><mn>1</mn></msub><mo>+</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>3</mn><mo>,</mo><mn>2</mn></mrow></msub><msub><mi>v</mi><mn>2</mn></msub><mo>+</mo><msub><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mn>3</mn><mo>,</mo><mn>3</mn></mrow></msub><msub><mi>v</mi><mn>3</mn></msub></math></span></span><span class="tex2jax_ignore math-holder">o_3 = \alpha_{3,0}v_0 + \alpha_{3,1}v_1+\alpha_{3,2}v_2 + \alpha_{3,3}v_3</span></span></span> </p><p>可以看到，在预测第5个字时，只有最后一步引入了新的计算，而  到  的计算和前面是完全重复的。</p><p>但是模型在推理的时候可不管这些，无论你是不是只要最后一个字的输出，它都把所有输入计算一遍，给出所有输出结果。</p><p>也就是说中间有很多我们用不到的计算，这样就造成了浪费。</p><p>而且随着生成的结果越来越多，输入的长度也越来越长，上面这个例子里，输入长度就从step0的10个，每步增长1，直到step5的15个。如果输入的instruction是让模型写作文，那可能就有800个step。这个情况下，step0被算了800次，step1被算了799次...这样浪费的计算资源确实不容忽视。</p><p>有没有什么办法可以重复利用上一个step里已经计算过的结果，减少浪费呢？</p><p><b>答案就是KV Cache</b>，利用一个缓存，把需要重复利用的中间计算结果存下来，减少重复计算。</p><p>总的来说，KV Cache是以空间换时间的做法，通过使用快速的缓存存取，减少了重复计算。（注意，只有decoder结构的模型可用，因为有mask attention的存在，使得前面的token可以不用关注后面的token）</p><p>但是，用了KV Cache之后也不是立刻万事大吉。</p><p>我们简单算一下，对于输入长度为 <span><span><span class="MathJax_SVG" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>s</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.551ex" viewBox="0 -555.2 469.5 667.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-73" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><span class="tex2jax_ignore math-holder">s</span></span></span> ，层数为 <span><span><span class="MathJax_SVG" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.065ex" viewBox="0 -776.4 681.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-4C" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>L</mi></math></span></span><span class="tex2jax_ignore math-holder">L</span></span></span> ，hidden size为 <span><span><span class="MathJax_SVG" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.216ex" height="2.065ex" viewBox="0 -776.4 523.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-64" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi></math></span></span><span class="tex2jax_ignore math-holder">d </span></span></span> 的模型，需要缓存的参数量为:</p><p><span><span><span class="MathJax_SVG" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><mo>&amp;#x00D7;</mo><mi>L</mi><mo>&amp;#x00D7;</mo><mi>s</mi><mo>&amp;#x00D7;</mo><mi>d</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="13.573ex" height="2.065ex" viewBox="0 -776.4 5843.8 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMAIN-32" x="0" y="0"></use><use xlink:href="#MJMAIN-D7" x="722" y="0"></use><use xlink:href="#MJMATHI-4C" x="1723" y="0"></use><use xlink:href="#MJMAIN-D7" x="2627" y="0"></use><use xlink:href="#MJMATHI-73" x="3627" y="0"></use><use xlink:href="#MJMAIN-D7" x="4319" y="0"></use><use xlink:href="#MJMATHI-64" x="5320" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mo>×</mo><mi>L</mi><mo>×</mo><mi>s</mi><mo>×</mo><mi>d</mi></math></span></span><span class="tex2jax_ignore math-holder">2\times L \times s \times d</span></span></span> </p><p>如果使用的是半精度浮点数，那么总共所需的空间就是:</p><p><span><span><span class="MathJax_SVG" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><mo>&amp;#x00D7;</mo><mn>2</mn><mo>&amp;#x00D7;</mo><mi>L</mi><mo>&amp;#x00D7;</mo><mi>s</mi><mo>&amp;#x00D7;</mo><mi>d</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.576ex" height="2.065ex" viewBox="0 -776.4 7567.3 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMAIN-32" x="0" y="0"></use><use xlink:href="#MJMAIN-D7" x="722" y="0"></use><use xlink:href="#MJMAIN-32" x="1723" y="0"></use><use xlink:href="#MJMAIN-D7" x="2446" y="0"></use><use xlink:href="#MJMATHI-4C" x="3446" y="0"></use><use xlink:href="#MJMAIN-D7" x="4350" y="0"></use><use xlink:href="#MJMATHI-73" x="5351" y="0"></use><use xlink:href="#MJMAIN-D7" x="6043" y="0"></use><use xlink:href="#MJMATHI-64" x="7043" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mo>×</mo><mn>2</mn><mo>×</mo><mi>L</mi><mo>×</mo><mi>s</mi><mo>×</mo><mi>d</mi></math></span></span><span class="tex2jax_ignore math-holder">2 \times 2\times L \times s \times d</span></span></span> </p><p>所占用的空间太大了，（MHA相比单头的情况，相当于只是把、、切成多份并行计算了，对于实际需要缓存的大小没有影响）</p><p>看来还需要进一步优化。</p><p>要保证模型的推理加速，要么增大Cache的大小，而且是需要一到两个数量级的增强，那这个只能靠黄老板了。</p><p>要么就是<b>减少需要缓存</b>的量。</p><h3 id="outline_7">为什么降低KV Cache的大小如此重要？</h3><p>众所周知，一般情况下LLM的推理都是在GPU上进行，单张GPU的显存是有限的，一部分我们要用来存放模型的参数和前向计算的激活值，这部分依赖于模型的体量，选定模型后它就是个常数；另外一部分我们要用来存放模型的KV Cache，这部分不仅依赖于模型的体量，还依赖于模型的输入长度，也就是在推理过程中是动态增长的，当Context长度足够长时，它的大小就会占主导地位，可能超出一张卡甚至一台机（8张卡）的总显存量。</p><p>在GPU上部署模型的原则是：能一张卡部署的，就不要跨多张卡；能一台机部署的，就不要跨多台机。这是因为“卡内通信带宽 &gt; 卡间通信带宽 &gt; 机间通信带宽”，由于“木桶效应”，模型部署时跨的设备越多，受设备间通信带宽的的“拖累”就越大，事实上即便是单卡H100内SRAM与HBM的带宽已经达到了3TB/s，但对于Short Context来说这个速度依然还是推理的瓶颈，更不用说更慢的卡间、机间通信了。</p><p>所以，<b>减少KV Cache的目的就是要实现在更少的设备上推理更长的Context，或者在相同的Context长度下让推理的batch size更大，从而实现更快的推理速度或者更大的吞吐总量。当然，最终目的都是为了实现更低的推理成本</b>。</p><p>（此段摘自苏剑林科学空间<a href="https://link.zhihu.com/?target=https%3A//spaces.ac.cn/archives/10091" target="_blank" rel="nofollow noreferrer"><span>https://</span><span>spaces.ac.cn/archives/1</span><span>0091</span></a>）</p><h2 id="outline_8">2. MQA</h2><p>MQA，即“<b>M</b>ulti-<b>Q</b>uery<b>A</b>ttention”，是减少KV Cache的一次非常朴素的尝试，MQA就是来减少缓存所需要的量的。Google在2019年就在《Fast Transformer Decoding: One Write-Head is All You Need》提出了MQA，不过那时候主要到的人不多，那是大家主要还是关注在用Bert把榜刷出新高上。</p><p>在MHA中，输入分别经过 <span><span><span class="MathJax_SVG" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>W</mi><mi>Q</mi></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>W</mi><mi>K</mi></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><msub><mi>W</mi><mi>V</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.157ex" height="2.707ex" viewBox="0 -776.4 6525.8 1165.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.904ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-57" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-51" x="1335" y="-218"></use><g transform="translate(1604,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(55.317) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(2433,0)"><use xlink:href="#MJMATHI-57" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-4B" x="1335" y="-213"></use></g><g transform="translate(4107,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(55.317) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(4937,0)"><use xlink:href="#MJMATHI-57" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-56" x="1335" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>W</mi><mi>Q</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>W</mi><mi>K</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><msub><mi>W</mi><mi>V</mi></msub></math></span></span><span class="tex2jax_ignore math-holder">W_Q，W_K，W_V</span></span></span> 的变换之后，都切成了n份（n=头数），维度也从 <span><span><span class="MathJax_SVG" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.797ex" height="2.322ex" viewBox="0 -776.4 2496.1 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.519ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-64" x="0" y="0"></use><g transform="translate(520,-150)"><use transform="scale(0.707)" xlink:href="#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-6F" x="878" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-64" x="1364" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-65" x="1887" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-6C" x="2354" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">d_{model}</span></span></span> 降到了 <span><span><span class="MathJax_SVG" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.883ex" height="2.322ex" viewBox="0 -776.4 2102.6 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.519ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-64" x="0" y="0"></use><g transform="translate(520,-150)"><use transform="scale(0.707)" xlink:href="#MJMATHI-68" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-65" x="576" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-61" x="1043" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-64" x="1572" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">d_{head}</span></span></span> ，分别进行attention计算再拼接。而MQA这里，在线性变换之后，只对 <span><span><span class="MathJax_SVG" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.45ex" viewBox="0 -776.4 791.5 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.647ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-51" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><span class="tex2jax_ignore math-holder">Q</span></span></span> 进行切分（和MHA一样），而 <span><span><span class="MathJax_SVG" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.066ex" height="2.065ex" viewBox="0 -776.4 889.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-4B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>K</mi></math></span></span><span class="tex2jax_ignore math-holder">K </span></span></span> ， <span><span><span class="MathJax_SVG" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.787ex" height="2.065ex" viewBox="0 -776.4 769.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-56" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math></span></span><span class="tex2jax_ignore math-holder">V</span></span></span> 则直接在线性变换的时候把维度降到 <span><span><span class="MathJax_SVG" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>d</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.883ex" height="2.322ex" viewBox="0 -776.4 2102.6 999.7" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.519ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-64" x="0" y="0"></use><g transform="translate(520,-150)"><use transform="scale(0.707)" xlink:href="#MJMATHI-68" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-65" x="576" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-61" x="1043" y="0"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-64" x="1572" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>d</mi><mrow class="MJX-TeXAtom-ORD"><mi>h</mi><mi>e</mi><mi>a</mi><mi>d</mi></mrow></msub></math></span></span><span class="tex2jax_ignore math-holder">d_{head} </span></span></span> （而不是切分变小），然后这n个Query头分别和同一份 <span><span><span class="MathJax_SVG" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.066ex" height="2.065ex" viewBox="0 -776.4 889.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-4B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>K</mi></math></span></span><span class="tex2jax_ignore math-holder">K</span></span></span> 、 <span><span><span class="MathJax_SVG" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.787ex" height="2.065ex" viewBox="0 -776.4 769.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-56" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math></span></span><span class="tex2jax_ignore math-holder">V</span></span></span> 进行attention计算，之后把结果拼接起来。</p><p>简单来说，就是MHA中，每个注意力头的K、V是不一样的，而MQA这里，每个注意力头的K、V是一样的，值是共享的。而其他步骤都和MHA一样。</p><p>这样一来，需要缓存的K、V值一下就从所有头变成一个头的量。很明显，MQA直接将KV Cache减少到了原来的 <span><span><span class="MathJax_SVG" id="MathJax-Element-43-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mn>1</mn><mi>n</mi></mfrac></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.822ex" height="3.35ex" viewBox="0 -997.7 784.6 1442.3" role="img" focusable="false" aria-hidden="true" style="vertical-align: -1.032ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(120,0)"><rect stroke="none" width="544" height="60" x="0" y="220"></rect><use transform="scale(0.707)" xlink:href="#MJMAIN-31" x="134" y="586"></use><use transform="scale(0.707)" xlink:href="#MJMATHI-6E" x="84" y="-488"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mn>1</mn><mi>n</mi></mfrac></math></span></span><span class="tex2jax_ignore math-holder">\frac{1}{n}</span></span></span> ，这是非常可观的，单从节省显存角度看已经是天花板了。</p><p>当然，由于共享了多个头的参数，限制了模型的表达能力，MQA虽然能好地支持推理加速，但是在效果上略略比MHA差一点，且MQA的支持者相信这部分损失可以通过进一步训练来弥补回。此外，注意到MQA由于共享了K、V，将会导致Attention的参数量减少了将近一半，而为了模型总参数量的不变，通常会相应地增大FFN/GLU的规模，这也能弥补一部分效果损失。</p><h2 id="outline_9">3. GQA</h2><p>既然MQA对效果有点影响，MHA缓存又存不下，那GQA（Grouped-Query Attention）就提出了一个折中的办法，既能减少MQA效果的损失，又相比MHA需要更少的缓存。</p><p>（文章：《GQA: Training Generalized Multi-Query Transformer Models from Multi-Head Checkpoints》，2023年）</p><p>GQA里， <span><span><span class="MathJax_SVG" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.45ex" viewBox="0 -776.4 791.5 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.647ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-51" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><span class="tex2jax_ignore math-holder">Q </span></span></span> 还是按原来MHA/MQA的做法不变。只使用一套共享的 <span><span><span class="MathJax_SVG" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.066ex" height="2.065ex" viewBox="0 -776.4 889.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-4B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>K</mi></math></span></span><span class="tex2jax_ignore math-holder">K </span></span></span> 、 <span><span><span class="MathJax_SVG" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.787ex" height="2.065ex" viewBox="0 -776.4 769.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-56" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math></span></span><span class="tex2jax_ignore math-holder">V</span></span></span> 不是效果不好吗，那就还是多弄几套。但是不要太多，数量还是比 <span><span><span class="MathJax_SVG" id="MathJax-Element-47-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.45ex" viewBox="0 -776.4 791.5 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.647ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-51" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><span class="tex2jax_ignore math-holder">Q</span></span></span> 的头数少一些。这样相当于把 <span><span><span class="MathJax_SVG" id="MathJax-Element-48-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.45ex" viewBox="0 -776.4 791.5 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.647ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-51" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><span class="tex2jax_ignore math-holder">Q</span></span></span> 的多个头给分了group，同一个group内的 <span><span><span class="MathJax_SVG" id="MathJax-Element-49-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>Q</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.838ex" height="2.45ex" viewBox="0 -776.4 791.5 1055" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.647ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-51" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><span class="tex2jax_ignore math-holder">Q</span></span></span> 共享同一套 <span><span><span class="MathJax_SVG" id="MathJax-Element-50-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>K</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.066ex" height="2.065ex" viewBox="0 -776.4 889.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-4B" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>K</mi></math></span></span><span class="tex2jax_ignore math-holder">K</span></span></span> 、 <span><span><span class="MathJax_SVG" id="MathJax-Element-51-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.787ex" height="2.065ex" viewBox="0 -776.4 769.5 889.1" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.262ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="#MJMATHI-56" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math></span></span><span class="tex2jax_ignore math-holder">V</span></span></span> ，不同group的Q使用的K、V不同。</p><p>MHA可以认为是K、V头数最大时的GQA，而MQA可以任务是K、V头数最少时的GQA。</p><p>看论文里的图就很直观：</p><p><img src="https://picx.zhimg.com/v2-8e8c92cd025c9933729496f1f3e53e73_r.jpg" class="large"></p><p>效果怎么样呢？</p><p><img src="https://pic1.zhimg.com/v2-9f9f7dc7b23afd208ac36c3628e082d4_r.jpg" class="large"></p><p>看表中2/3/4行对比，GQA的速度相比MHA有明显提升，而效果上比MQA也好一些，能做到和MHA基本没差距。文中提到，这里的MQA和GQA都是通过average pooling从MHA初始化而来，然后进行了少量的训练得到的。如果我们想要把之前用MHA训练的模型改造成GQA，也可以通过这样的方法，增加少量训练来实现。当然如果从一开始就加上，从零开始训练，也是没有问题的。</p><p>Llama2用的就是GQA，在tech report中也做了MHA、MQA、GQA的效果对比，可以看到效果确实很不错。</p><h2 id="outline_10">4. MLA</h2><p>有了MHA、MQA、GQA的铺垫，我们理解MLA（<b>M</b>ulti-head <b>L</b>atent <b>A</b>ttention）就相对容易一些了。DeepSeek-V2的技术报告里是从低秩投影的角度引入MLA的，以至于有部分读者提出“为什么LoRA提出这么久了，直到MLA才提出对KV Cache低秩分解的做法”之类的疑问。</p><p>然而，笔者认为低秩投影这个角度并不贴近本质，因为要说低秩投影的话，事实上只要我们将GQA的所有K、V叠在一起，就会发现GQA也相当于在做低秩投影：</p><p><img src="https://pica.zhimg.com/v2-6d859e5ec646c8ce3dba27a65924b100_r.jpg" class="large"></p><p>此段摘抄自苏剑林科学空间</p><p>具体我还在理解，等理解后再更新</p><p>参考文章：</p><p><a target="_blank" href="https://link.zhihu.com/?target=https%3A//mp.weixin.qq.com/s/Ont7ud7N3MzeKPbqK61CKg" class="link"></a></p><p><a target="_blank" href="https://link.zhihu.com/?target=https%3A//spaces.ac.cn/archives/10091" class="link"></a></p><p><a target="_blank" href="//zhuanlan.zhihu.com/p/22298179654"><span aria-label="发布于 2025-02-08 17:25">编辑于 2025-02-17 14:05</span></a></p><p itemprop="zhihu:question" itemtype="http://schema.org/Question"><a target="_blank" href="//www.zhihu.com/question/460572179/answer/98400871442" class="link">有没有女主人间清醒的小说？</a></p><p><span options="[object Object]" itemprop="text">宫墙往事： 我爹娘撒了个谎。 于是我从要被卖掉的「贱女」，变成了长公主的女儿。 长公主喜极而泣，太后看我的眼神却带着些轻视。 我料想，她应当知道我是个…</span></p><p itemprop="zhihu:question" itemtype="http://schema.org/Question"><a target="_blank" href="//www.zhihu.com/question/12930480499/answer/109163421544" class="link">字节大模型团队负责人换将，原 DeepMind 副总裁吴永辉挂帅，如何看待此次架构调整？</a></p><p><span options="[object Object]" itemprop="text">魔道子： 字节内部其实有一个真正的大模型大佬，过去一年搞出好几个大模型的先进技术。</span></p><p itemprop="zhihu:question" itemtype="http://schema.org/Question"><a target="_blank" href="//www.zhihu.com/question/609920887/answer/108404159378" class="link">博士是怎么废掉的？</a></p><p><span options="[object Object]" itemprop="text">Schroenberg： 博士不会废掉。 你已经是博士生了，这意味着教育系统严苛的选拔机制已经给予你它所能给予的最高的承认。无论你遭受了多大的打击，面临…</span></p><p itemprop="zhihu:question" itemtype="http://schema.org/Question"><a target="_blank" href="//www.zhihu.com/question/426238388/answer/2937544836" class="link">请问计算机视觉（CV）算法岗在社招时更看重什么？</a></p><p><span options="[object Object]" itemprop="text">ChenJ： 1. cv高频code: 1. iou 2. nms 3. Conv2d, bchw-conv 4. k-means…</span></p><p itemprop="zhihu:question" itemtype="http://schema.org/Question"><a target="_blank" href="//www.zhihu.com/question/12397926866/answer/107872463856" class="link">印度10年前大谈印度制造，总理莫迪几乎照抄了东亚崛起时代的政策，为什么不能像中国一样爆发式增长？</a></p><p><span options="[object Object]" itemprop="text">一针见血容嬷嬷： 因为世界的能源有限，要发展崛起必须有足够的能源支撑，东大每年就占走了世界一半的石油，钢铁，煤矿等资源，你让印度怎么发展？靠念经烧牛粪…</span></p><h2 id="outline_11"><span><a href="//zhuanlan.zhihu.com/p/26085721000" target="_blank" rel="noopener noreferrer" class="link">25计算机考研</a></span></h2><p><span options="[object Object]" itemprop="articleBody">我会发财： 本人情况 本人目前研究生毕业，秋招顺利签约了一家国企研究所单位，同时在校期间跨专业结合计算机发表了两篇SCI论文3区。国际专利一个，获得研究…</span></p><h2 id="outline_12"><span><a href="//zhuanlan.zhihu.com/p/26110005583" target="_blank" rel="noopener noreferrer" class="link">二战科软失败贴（Note to Self）</a></span></h2><p><span options="[object Object]" itemprop="articleBody">捧友的后面我在呢： 人生中的前二十多年，从未写过一篇帖子。但还是想给未来的自己留下一些回忆，亦或是让未来的自己看到时能够释怀，遂写下此贴，以记录那些扎…</span></p><p itemprop="zhihu:question" itemtype="http://schema.org/Question"><a target="_blank" href="//www.zhihu.com/question/621234978/answer/3479972991" class="link">深度学习硕士毕业论文工作量不够怎么办？</a></p><div class="left"><div><img src="https://picx.zhimg.com/50/v2-b88676e33cd7a354eed1529d381b719b_200x0.jpg?source=b6762063" class="tiny large"></div></div><p><span options="[object Object]" itemprop="text">Sam聊算法： 24毕业季来答，实在要凑（水）篇幅的话，可以从<b>数据集</b>、<b>模型backbone</b>、<b>可视化分析、Case Study、方法框架图</b>等角度来拓展，让自己的工作看上去好像更像那么回事。毕竟硕士论文对n…</span></p><h2 id="outline_13"><span><a href="//zhuanlan.zhihu.com/p/690062139" target="_blank" rel="noopener noreferrer" class="link">2024上海交通大学11408一战390分经验贴（计算机专硕，初试）</a></span></h2><div class="left"><div><img src="https://pic1.zhimg.com/v2-855e78aeb13f039614ac2fa78f4b6304_200x0.jpg?source=7e7ef6e2&amp;needBackground=1" class="tiny large"></div></div><p><span></span></p><div><div><span options="[object Object]" itemprop="articleBody">枫铃树： 先看成绩 初试： <table><tbody><tr><th>政治</th><th>英语一</th><th>数学一</th><th>计算机（408）</th><th>总分</th></tr><tr><td>6X</td><td>8X</td><td>1XX</td><td>1XX</td><td>390</td></tr></tbody></table> 复试： <table><tbody><tr><th>笔试（机考）</th><th>面试</th><th>总分</th></tr><tr><td>100</td><td>XX</td><td>1XX</td></tr></tbody></table> 写在前面 经验贴具有一定主观性，仅供参考。请根据自己实际情况食用。 本人报考方…</span></div></div><p></p><p itemprop="zhihu:question" itemtype="http://schema.org/Question"><a target="_blank" href="//www.zhihu.com/question/466679564/answer/36814174643" class="link">认真学习完 MIT 6.824和CMU 15445 可以找到相关的工作吗?</a></p><div class="left"><div><img src="https://picx.zhimg.com/50/v2-d39166def5183277af8042da0c6f28ab_200x0.jpg?source=b6762063" class="tiny large"></div></div><p><span options="[object Object]" itemprop="text">香草美人： <b>2024.11.21现身说法, 2025届秋招, 如果你只有这两个项目没有别的东西的话, 难度不小。</b> <b>为什么基架相关工作这么难</b> MIT 6.824和CMU 15445的相关工作基本上就是分布式存…</span></p><p itemprop="zhihu:question" itemtype="http://schema.org/Question"><a target="_blank" href="//www.zhihu.com/question/367357782/answer/2873057728" class="link">你有哪些无意间拍下的女孩照片，惊艳了众人？</a></p><div class="left"><div><img src="https://picx.zhimg.com/50/v2-cc1e497d2de517223a8e081ce38dbb2f_200x0.jpg?source=b6762063" class="tiny large"></div></div><p><span options="[object Object]" itemprop="text">书曼爹： 工作场合拍照写报告的，这姑娘突然剪刀手，照片不能用了…</span></p><h2 id="outline_14"><span><a href="//zhuanlan.zhihu.com/p/26091002227" target="_blank" rel="noopener noreferrer" class="link">FlashMLA与FlashAttention之间的区别</a></span></h2><p><span options="[object Object]" itemprop="articleBody">行知： deepseek今天开源了Multi-head Latent Attention(MLA) forward CUDA kernel <a href="https://link.zhihu.com/?target=https%3A//github.com/deepseek-ai/FlashMLA" target="_blank" rel="nofollow noreferrer"><span>https://</span><span>githu</span></a>…</span></p><p itemprop="zhihu:question" itemtype="http://schema.org/Question"><a target="_blank" href="//www.zhihu.com/question/439389563/answer/3217326241" class="link">深度学习论文上的注意力可视化话图怎么来？</a></p><div class="left"><div><img src="https://picx.zhimg.com/50/v2-f771f4f87bebff0eb4b673f8de65eaf2_200x0.jpg?source=b6762063" class="tiny large"></div></div><p><span options="[object Object]" itemprop="text">Hao Bai： 泻药。自从DINO被提出后，注意力图的可视化瞬间成为热点。这篇tutorial就来讨论一下训练完Transformer后，如何可视化注意力图。典型的注意力图例子如下图： DINO首先提出…</span></p><p style="text-align:center;margin-top:100px;">由 <a href="https://circlereader.com" target="_blank">Circle 阅读助手</a> 生成</p></div></div></div></div></body></html>